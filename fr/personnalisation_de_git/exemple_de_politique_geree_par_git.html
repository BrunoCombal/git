<!DOCTYPE HTML>
<html lang="en-US">
    <head prefix="og: http://ogp.me/ns# book: http://ogp.me/ns/book#">
        
        <meta charset="UTF-8">
        <title>Exemple de politique gérée par Git | Learn Git</title>

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="robots" content="index, follow">
        <meta name="author" content="GitbookIO">
        <meta name="description" content="The entire Pro Git book.">
        <meta name="keywords" content="gitbook,github" >
        <meta name="generator" content="www.gitbook.io">

        
        <link rel="next" href="../personnalisation_de_git/resume.html" />
        
        
        <link rel="prev" href="../personnalisation_de_git/crochets_git.html" />
        

        <meta property="og:title" content="Exemple de politique gérée par Git | Learn Git">
        <meta property="og:site_name" content="Learn Git">
        <meta property="og:type" content="book">
        <meta property="og:locale" content="en_US">

        <meta property="book:author" content="https://github.com/GitbookIO">
        <meta property="book:tag" content="GitBook">

        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">

        <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">
        
    </head>
    <body>
        
    <div class="book" data-github="GitbookIO/git" data-level="1.4" data-basepath=".." data-revision="1397503694393">
    <div class="book-header">
    <!-- Actions Left -->
    
    <a href="https://github.com/GitbookIO/git" target="_blank" class="btn pull-left"><i class="fa fa-github-alt"></i></a>
    
    <a href="#" class="btn pull-left toggle-summary"><i class="fa fa-align-justify"></i></a>
    <a href="#" class="btn pull-left toggle-search"><i class="fa fa-search"></i></a>

    <!-- Actions Right -->
    <a href="#" target="_blank" class="btn pull-right" data-sharing="google-plus"><i class="fa fa-google-plus"></i></a>
    <a href="#" target="_blank" class="btn pull-right" data-sharing="facebook"><i class="fa fa-facebook"></i></a>
    <a href="#" target="_blank" class="btn pull-right" data-sharing="twitter"><i class="fa fa-twitter"></i></a>

    
    <a href="https://github.com/GitbookIO/git/stargazers" target="_blank" class="btn pull-right count-star"><i class="fa fa-star-o"></i> Star (<span>-</span>)</a>
    <a href="https://github.com/GitbookIO/git/watchers" target="_blank" class="btn pull-right count-watch"><i class="fa fa-eye"></i> Watch (<span>-</span>)</a>
    

    <!-- Title -->
    <h1><a href="../" >Learn Git</a></h1>
</div>

    <div class="book-summary">
    <div class="book-search">
        <input type="text" placeholder="Search" class="form-control" />
    </div>
    <ul class="summary">
        
        <li>
            <a href="https://github.com/GitbookIO" target="blank">About the author</a>
        </li>
        <li>
            <a href="https://github.com/GitbookIO/git/issues" target="blank">Questions and Issues</a>
        </li>
        <li>
            <a href="https://github.com/GitbookIO/git/edit/master/personnalisation_de_git/exemple_de_politique_geree_par_git.md" target="blank">Edit and Contribute</a>
        </li>
        <li class="divider"></li>
        
        <li data-level="0" data-path="index.html">
            <a href="../"><i class="fa fa-check"></i> Introduction</a>
        </li>
        
            <li  data-level="1" data-path="personnalisation_de_git/README.html">
                
                <a href="../personnalisation_de_git/README.html">
                    <i class="fa fa-check"></i> <b>1.</b> Personnalisation de Git
                </a>
                
                
                <ul class="articles">
                    
                        <li  data-level="1.1" data-path="personnalisation_de_git/configuration_de_git.html">
                            
                            <a href="../personnalisation_de_git/configuration_de_git.html">
                                <i class="fa fa-check"></i> <b>1.1.</b> Configuration de Git
                            </a>
                            
                        </li>
                    
                        <li  data-level="1.2" data-path="personnalisation_de_git/attributs_git.html">
                            
                            <a href="../personnalisation_de_git/attributs_git.html">
                                <i class="fa fa-check"></i> <b>1.2.</b> Attributs Git
                            </a>
                            
                        </li>
                    
                        <li  data-level="1.3" data-path="personnalisation_de_git/crochets_git.html">
                            
                            <a href="../personnalisation_de_git/crochets_git.html">
                                <i class="fa fa-check"></i> <b>1.3.</b> Crochets Git
                            </a>
                            
                        </li>
                    
                        <li  data-level="1.4" data-path="personnalisation_de_git/exemple_de_politique_geree_par_git.html">
                            
                            <a href="../personnalisation_de_git/exemple_de_politique_geree_par_git.html">
                                <i class="fa fa-check"></i> <b>1.4.</b> Exemple de politique gérée par Git
                            </a>
                            
                        </li>
                    
                        <li  data-level="1.5" data-path="personnalisation_de_git/resume.html">
                            
                            <a href="../personnalisation_de_git/resume.html">
                                <i class="fa fa-check"></i> <b>1.5.</b> Résumé
                            </a>
                            
                        </li>
                    
                </ul>
                
            </li>
        
            <li  data-level="2" data-path="demarrage_rapide/README.html">
                
                <a href="../demarrage_rapide/README.html">
                    <i class="fa fa-check"></i> <b>2.</b> Démarrage rapide
                </a>
                
                
                <ul class="articles">
                    
                        <li  data-level="2.1" data-path="demarrage_rapide/a_propos_de_la_gestion_de_version.html">
                            
                            <a href="../demarrage_rapide/a_propos_de_la_gestion_de_version.html">
                                <i class="fa fa-check"></i> <b>2.1.</b> À propos de la gestion de version
                            </a>
                            
                        </li>
                    
                        <li  data-level="2.2" data-path="demarrage_rapide/une_rapide_histoire_de_git.html">
                            
                            <a href="../demarrage_rapide/une_rapide_histoire_de_git.html">
                                <i class="fa fa-check"></i> <b>2.2.</b> Une rapide histoire de Git
                            </a>
                            
                        </li>
                    
                        <li  data-level="2.3" data-path="demarrage_rapide/rudiments_de_git.html">
                            
                            <a href="../demarrage_rapide/rudiments_de_git.html">
                                <i class="fa fa-check"></i> <b>2.3.</b> Rudiments de Git
                            </a>
                            
                        </li>
                    
                        <li  data-level="2.4" data-path="demarrage_rapide/installation_de_git.html">
                            
                            <a href="../demarrage_rapide/installation_de_git.html">
                                <i class="fa fa-check"></i> <b>2.4.</b> Installation de Git
                            </a>
                            
                        </li>
                    
                        <li  data-level="2.5" data-path="demarrage_rapide/parametrage_a_la_premiere_utilisation_de_git.html">
                            
                            <a href="../demarrage_rapide/parametrage_a_la_premiere_utilisation_de_git.html">
                                <i class="fa fa-check"></i> <b>2.5.</b> Paramétrage à la première utilisation de Git
                            </a>
                            
                        </li>
                    
                        <li  data-level="2.6" data-path="demarrage_rapide/obtenir_de_laide.html">
                            
                            <a href="../demarrage_rapide/obtenir_de_laide.html">
                                <i class="fa fa-check"></i> <b>2.6.</b> Obtenir de l&#39;aide
                            </a>
                            
                        </li>
                    
                        <li  data-level="2.7" data-path="demarrage_rapide/resume.html">
                            
                            <a href="../demarrage_rapide/resume.html">
                                <i class="fa fa-check"></i> <b>2.7.</b> Résumé
                            </a>
                            
                        </li>
                    
                </ul>
                
            </li>
        
            <li  data-level="3" data-path="les_branches_avec_git/README.html">
                
                <a href="../les_branches_avec_git/README.html">
                    <i class="fa fa-check"></i> <b>3.</b> Les branches avec Git
                </a>
                
                
                <ul class="articles">
                    
                        <li  data-level="3.1" data-path="les_branches_avec_git/ce_quest_une_branche.html">
                            
                            <a href="../les_branches_avec_git/ce_quest_une_branche.html">
                                <i class="fa fa-check"></i> <b>3.1.</b> Ce qu&#39;est une branche
                            </a>
                            
                        </li>
                    
                        <li  data-level="3.2" data-path="les_branches_avec_git/brancher_et_fusionner_les_bases.html">
                            
                            <a href="../les_branches_avec_git/brancher_et_fusionner_les_bases.html">
                                <i class="fa fa-check"></i> <b>3.2.</b> Brancher et fusionner : les bases
                            </a>
                            
                        </li>
                    
                        <li  data-level="3.3" data-path="les_branches_avec_git/gestion_de_branches.html">
                            
                            <a href="../les_branches_avec_git/gestion_de_branches.html">
                                <i class="fa fa-check"></i> <b>3.3.</b> Gestion de branches
                            </a>
                            
                        </li>
                    
                        <li  data-level="3.4" data-path="les_branches_avec_git/travailler_avec_les_branches.html">
                            
                            <a href="../les_branches_avec_git/travailler_avec_les_branches.html">
                                <i class="fa fa-check"></i> <b>3.4.</b> Travailler avec les branches
                            </a>
                            
                        </li>
                    
                        <li  data-level="3.5" data-path="les_branches_avec_git/les_branches_distantes.html">
                            
                            <a href="../les_branches_avec_git/les_branches_distantes.html">
                                <i class="fa fa-check"></i> <b>3.5.</b> Les branches distantes
                            </a>
                            
                        </li>
                    
                        <li  data-level="3.6" data-path="les_branches_avec_git/rebaser.html">
                            
                            <a href="../les_branches_avec_git/rebaser.html">
                                <i class="fa fa-check"></i> <b>3.6.</b> Rebaser
                            </a>
                            
                        </li>
                    
                        <li  data-level="3.7" data-path="les_branches_avec_git/resume.html">
                            
                            <a href="../les_branches_avec_git/resume.html">
                                <i class="fa fa-check"></i> <b>3.7.</b> Résumé
                            </a>
                            
                        </li>
                    
                </ul>
                
            </li>
        
            <li  data-level="4" data-path="git_sur_le_serveur/README.html">
                
                <a href="../git_sur_le_serveur/README.html">
                    <i class="fa fa-check"></i> <b>4.</b> Git sur le serveur
                </a>
                
                
                <ul class="articles">
                    
                        <li  data-level="4.1" data-path="git_sur_le_serveur/protocoles.html">
                            
                            <a href="../git_sur_le_serveur/protocoles.html">
                                <i class="fa fa-check"></i> <b>4.1.</b> Protocoles
                            </a>
                            
                        </li>
                    
                        <li  data-level="4.2" data-path="git_sur_le_serveur/installation_de_git_sur_un_serveur.html">
                            
                            <a href="../git_sur_le_serveur/installation_de_git_sur_un_serveur.html">
                                <i class="fa fa-check"></i> <b>4.2.</b> Installation de Git sur un serveur
                            </a>
                            
                        </li>
                    
                        <li  data-level="4.3" data-path="git_sur_le_serveur/generation_des_cles_publiques_ssh.html">
                            
                            <a href="../git_sur_le_serveur/generation_des_cles_publiques_ssh.html">
                                <i class="fa fa-check"></i> <b>4.3.</b> Génération des clés publiques SSH
                            </a>
                            
                        </li>
                    
                        <li  data-level="4.4" data-path="git_sur_le_serveur/mise_en_place_du_serveur.html">
                            
                            <a href="../git_sur_le_serveur/mise_en_place_du_serveur.html">
                                <i class="fa fa-check"></i> <b>4.4.</b> Mise en place du serveur
                            </a>
                            
                        </li>
                    
                        <li  data-level="4.5" data-path="git_sur_le_serveur/acces_public.html">
                            
                            <a href="../git_sur_le_serveur/acces_public.html">
                                <i class="fa fa-check"></i> <b>4.5.</b> Accès public
                            </a>
                            
                        </li>
                    
                        <li  data-level="4.6" data-path="git_sur_le_serveur/gitweb.html">
                            
                            <a href="../git_sur_le_serveur/gitweb.html">
                                <i class="fa fa-check"></i> <b>4.6.</b> GitWeb
                            </a>
                            
                        </li>
                    
                        <li  data-level="4.7" data-path="git_sur_le_serveur/gitosis.html">
                            
                            <a href="../git_sur_le_serveur/gitosis.html">
                                <i class="fa fa-check"></i> <b>4.7.</b> Gitosis
                            </a>
                            
                        </li>
                    
                        <li  data-level="4.8" data-path="git_sur_le_serveur/gitolite.html">
                            
                            <a href="../git_sur_le_serveur/gitolite.html">
                                <i class="fa fa-check"></i> <b>4.8.</b> Gitolite
                            </a>
                            
                        </li>
                    
                        <li  data-level="4.9" data-path="git_sur_le_serveur/le_daemon_git.html">
                            
                            <a href="../git_sur_le_serveur/le_daemon_git.html">
                                <i class="fa fa-check"></i> <b>4.9.</b> Le *daemon* Git
                            </a>
                            
                        </li>
                    
                        <li  data-level="4.10" data-path="git_sur_le_serveur/git_heberge.html">
                            
                            <a href="../git_sur_le_serveur/git_heberge.html">
                                <i class="fa fa-check"></i> <b>4.10.</b> Git hébergé
                            </a>
                            
                        </li>
                    
                        <li  data-level="4.11" data-path="git_sur_le_serveur/resume.html">
                            
                            <a href="../git_sur_le_serveur/resume.html">
                                <i class="fa fa-check"></i> <b>4.11.</b> Résumé
                            </a>
                            
                        </li>
                    
                </ul>
                
            </li>
        
            <li  data-level="5" data-path="git_distribue/README.html">
                
                <a href="../git_distribue/README.html">
                    <i class="fa fa-check"></i> <b>5.</b> Git distribué
                </a>
                
                
                <ul class="articles">
                    
                        <li  data-level="5.1" data-path="git_distribue/developpements_distribues.html">
                            
                            <a href="../git_distribue/developpements_distribues.html">
                                <i class="fa fa-check"></i> <b>5.1.</b> Développements distribués
                            </a>
                            
                        </li>
                    
                        <li  data-level="5.2" data-path="git_distribue/contribution_a_un_projet.html">
                            
                            <a href="../git_distribue/contribution_a_un_projet.html">
                                <i class="fa fa-check"></i> <b>5.2.</b> Contribution à un projet
                            </a>
                            
                        </li>
                    
                        <li  data-level="5.3" data-path="git_distribue/maintenance_dun_projet.html">
                            
                            <a href="../git_distribue/maintenance_dun_projet.html">
                                <i class="fa fa-check"></i> <b>5.3.</b> Maintenance d&#39;un projet
                            </a>
                            
                        </li>
                    
                        <li  data-level="5.4" data-path="git_distribue/resume.html">
                            
                            <a href="../git_distribue/resume.html">
                                <i class="fa fa-check"></i> <b>5.4.</b> Résumé
                            </a>
                            
                        </li>
                    
                </ul>
                
            </li>
        
            <li  data-level="6" data-path="utilitaires_git/README.html">
                
                <a href="../utilitaires_git/README.html">
                    <i class="fa fa-check"></i> <b>6.</b> Utilitaires Git
                </a>
                
                
                <ul class="articles">
                    
                        <li  data-level="6.1" data-path="utilitaires_git/selection_des_versions.html">
                            
                            <a href="../utilitaires_git/selection_des_versions.html">
                                <i class="fa fa-check"></i> <b>6.1.</b> Sélection des versions
                            </a>
                            
                        </li>
                    
                        <li  data-level="6.2" data-path="utilitaires_git/indexation_interactive.html">
                            
                            <a href="../utilitaires_git/indexation_interactive.html">
                                <i class="fa fa-check"></i> <b>6.2.</b> Indexation interactive
                            </a>
                            
                        </li>
                    
                        <li  data-level="6.3" data-path="utilitaires_git/le_remisage.html">
                            
                            <a href="../utilitaires_git/le_remisage.html">
                                <i class="fa fa-check"></i> <b>6.3.</b> Le remisage
                            </a>
                            
                        </li>
                    
                        <li  data-level="6.4" data-path="utilitaires_git/reecrire_lhistorique.html">
                            
                            <a href="../utilitaires_git/reecrire_lhistorique.html">
                                <i class="fa fa-check"></i> <b>6.4.</b> Réécrire l&#39;historique
                            </a>
                            
                        </li>
                    
                        <li  data-level="6.5" data-path="utilitaires_git/deboguer_avec_git.html">
                            
                            <a href="../utilitaires_git/deboguer_avec_git.html">
                                <i class="fa fa-check"></i> <b>6.5.</b> Deboguer avec Git
                            </a>
                            
                        </li>
                    
                        <li  data-level="6.6" data-path="utilitaires_git/sous_modules.html">
                            
                            <a href="../utilitaires_git/sous_modules.html">
                                <i class="fa fa-check"></i> <b>6.6.</b> Sous-modules
                            </a>
                            
                        </li>
                    
                        <li  data-level="6.7" data-path="utilitaires_git/fusion_de_sous_arborescences.html">
                            
                            <a href="../utilitaires_git/fusion_de_sous_arborescences.html">
                                <i class="fa fa-check"></i> <b>6.7.</b> Fusion de sous-arborescences
                            </a>
                            
                        </li>
                    
                        <li  data-level="6.8" data-path="utilitaires_git/resume.html">
                            
                            <a href="../utilitaires_git/resume.html">
                                <i class="fa fa-check"></i> <b>6.8.</b> Résumé
                            </a>
                            
                        </li>
                    
                </ul>
                
            </li>
        
            <li  data-level="7" data-path="les_bases_de_git/README.html">
                
                <a href="../les_bases_de_git/README.html">
                    <i class="fa fa-check"></i> <b>7.</b> Les bases de Git
                </a>
                
                
                <ul class="articles">
                    
                        <li  data-level="7.1" data-path="les_bases_de_git/demarrer_un_depot_git.html">
                            
                            <a href="../les_bases_de_git/demarrer_un_depot_git.html">
                                <i class="fa fa-check"></i> <b>7.1.</b> Démarrer un dépôt Git
                            </a>
                            
                        </li>
                    
                        <li  data-level="7.2" data-path="les_bases_de_git/enregistrer_des_modifications_dans_le_depot.html">
                            
                            <a href="../les_bases_de_git/enregistrer_des_modifications_dans_le_depot.html">
                                <i class="fa fa-check"></i> <b>7.2.</b> Enregistrer des modifications dans le dépôt
                            </a>
                            
                        </li>
                    
                        <li  data-level="7.3" data-path="les_bases_de_git/visualiser_lhistorique_des_validations.html">
                            
                            <a href="../les_bases_de_git/visualiser_lhistorique_des_validations.html">
                                <i class="fa fa-check"></i> <b>7.3.</b> Visualiser l&#39;historique des validations
                            </a>
                            
                        </li>
                    
                        <li  data-level="7.4" data-path="les_bases_de_git/annuler_des_actions.html">
                            
                            <a href="../les_bases_de_git/annuler_des_actions.html">
                                <i class="fa fa-check"></i> <b>7.4.</b> Annuler des actions
                            </a>
                            
                        </li>
                    
                        <li  data-level="7.5" data-path="les_bases_de_git/travailler_avec_des_depots_distants.html">
                            
                            <a href="../les_bases_de_git/travailler_avec_des_depots_distants.html">
                                <i class="fa fa-check"></i> <b>7.5.</b> Travailler avec des dépôts distants
                            </a>
                            
                        </li>
                    
                        <li  data-level="7.6" data-path="les_bases_de_git/etiquetage.html">
                            
                            <a href="../les_bases_de_git/etiquetage.html">
                                <i class="fa fa-check"></i> <b>7.6.</b> Étiquetage
                            </a>
                            
                        </li>
                    
                        <li  data-level="7.7" data-path="les_bases_de_git/trucs_et_astuces.html">
                            
                            <a href="../les_bases_de_git/trucs_et_astuces.html">
                                <i class="fa fa-check"></i> <b>7.7.</b> Trucs et astuces
                            </a>
                            
                        </li>
                    
                        <li  data-level="7.8" data-path="les_bases_de_git/resume.html">
                            
                            <a href="../les_bases_de_git/resume.html">
                                <i class="fa fa-check"></i> <b>7.8.</b> Résumé
                            </a>
                            
                        </li>
                    
                </ul>
                
            </li>
        
            <li  data-level="8" data-path="git_et_les_autres_systemes/README.html">
                
                <a href="../git_et_les_autres_systemes/README.html">
                    <i class="fa fa-check"></i> <b>8.</b> Git et les autres systèmes
                </a>
                
                
                <ul class="articles">
                    
                        <li  data-level="8.1" data-path="git_et_les_autres_systemes/git_et_subversion.html">
                            
                            <a href="../git_et_les_autres_systemes/git_et_subversion.html">
                                <i class="fa fa-check"></i> <b>8.1.</b> Git et Subversion
                            </a>
                            
                        </li>
                    
                        <li  data-level="8.2" data-path="git_et_les_autres_systemes/migrer_sur_git.html">
                            
                            <a href="../git_et_les_autres_systemes/migrer_sur_git.html">
                                <i class="fa fa-check"></i> <b>8.2.</b> Migrer sur Git
                            </a>
                            
                        </li>
                    
                        <li  data-level="8.3" data-path="git_et_les_autres_systemes/resume.html">
                            
                            <a href="../git_et_les_autres_systemes/resume.html">
                                <i class="fa fa-check"></i> <b>8.3.</b> Résumé
                            </a>
                            
                        </li>
                    
                </ul>
                
            </li>
        
            <li  data-level="9" data-path="les_tripes_de_git/README.html">
                
                <a href="../les_tripes_de_git/README.html">
                    <i class="fa fa-check"></i> <b>9.</b> Les tripes de Git
                </a>
                
                
                <ul class="articles">
                    
                        <li  data-level="9.1" data-path="les_tripes_de_git/plomberie_et_porcelaine.html">
                            
                            <a href="../les_tripes_de_git/plomberie_et_porcelaine.html">
                                <i class="fa fa-check"></i> <b>9.1.</b> Plomberie et porcelaine
                            </a>
                            
                        </li>
                    
                        <li  data-level="9.2" data-path="les_tripes_de_git/les_objets_git.html">
                            
                            <a href="../les_tripes_de_git/les_objets_git.html">
                                <i class="fa fa-check"></i> <b>9.2.</b> Les objets Git
                            </a>
                            
                        </li>
                    
                        <li  data-level="9.3" data-path="les_tripes_de_git/references_git.html">
                            
                            <a href="../les_tripes_de_git/references_git.html">
                                <i class="fa fa-check"></i> <b>9.3.</b> Références Git
                            </a>
                            
                        </li>
                    
                        <li  data-level="9.4" data-path="les_tripes_de_git/fichiers_groupes.html">
                            
                            <a href="../les_tripes_de_git/fichiers_groupes.html">
                                <i class="fa fa-check"></i> <b>9.4.</b> Fichiers groupés
                            </a>
                            
                        </li>
                    
                        <li  data-level="9.5" data-path="les_tripes_de_git/les_references_specifiques.html">
                            
                            <a href="../les_tripes_de_git/les_references_specifiques.html">
                                <i class="fa fa-check"></i> <b>9.5.</b> Les références spécifiques
                            </a>
                            
                        </li>
                    
                        <li  data-level="9.6" data-path="les_tripes_de_git/protocoles_de_transfert.html">
                            
                            <a href="../les_tripes_de_git/protocoles_de_transfert.html">
                                <i class="fa fa-check"></i> <b>9.6.</b> Protocoles de transfert
                            </a>
                            
                        </li>
                    
                        <li  data-level="9.7" data-path="les_tripes_de_git/maintenance_et_recuperation_de_donnees.html">
                            
                            <a href="../les_tripes_de_git/maintenance_et_recuperation_de_donnees.html">
                                <i class="fa fa-check"></i> <b>9.7.</b> Maintenance et récupération de données
                            </a>
                            
                        </li>
                    
                        <li  data-level="9.8" data-path="les_tripes_de_git/resume.html">
                            
                            <a href="../les_tripes_de_git/resume.html">
                                <i class="fa fa-check"></i> <b>9.8.</b> Résumé
                            </a>
                            
                        </li>
                    
                </ul>
                
            </li>
        
    </ul>
</div>

    <div class="book-body">
        <div class="body-inner">
            <div class="page-wrapper" tabindex="-1">
                <div class="book-progress">
    <div class="bar">
        <div class="inner" style="width: 7.142857142857143%;min-width: 5.714285714285714%;"></div>
    </div>
    <div class="chapters">
    
        <a href="../index.html" title="Introduction" class="chapter done new-chapter" data-progress="0" style="left: 0%;"></a>
    
        <a href="../personnalisation_de_git/README.html" title="Personnalisation de Git" class="chapter done new-chapter" data-progress="1" style="left: 1.4285714285714286%;"></a>
    
        <a href="../personnalisation_de_git/configuration_de_git.html" title="Configuration de Git" class="chapter done " data-progress="1.1" style="left: 2.857142857142857%;"></a>
    
        <a href="../personnalisation_de_git/attributs_git.html" title="Attributs Git" class="chapter done " data-progress="1.2" style="left: 4.285714285714286%;"></a>
    
        <a href="../personnalisation_de_git/crochets_git.html" title="Crochets Git" class="chapter done " data-progress="1.3" style="left: 5.714285714285714%;"></a>
    
        <a href="../personnalisation_de_git/exemple_de_politique_geree_par_git.html" title="Exemple de politique gérée par Git" class="chapter done " data-progress="1.4" style="left: 7.142857142857143%;"></a>
    
        <a href="../personnalisation_de_git/resume.html" title="Résumé" class="chapter  " data-progress="1.5" style="left: 8.571428571428571%;"></a>
    
        <a href="../demarrage_rapide/README.html" title="Démarrage rapide" class="chapter  new-chapter" data-progress="2" style="left: 10%;"></a>
    
        <a href="../demarrage_rapide/a_propos_de_la_gestion_de_version.html" title="À propos de la gestion de version" class="chapter  " data-progress="2.1" style="left: 11.428571428571429%;"></a>
    
        <a href="../demarrage_rapide/une_rapide_histoire_de_git.html" title="Une rapide histoire de Git" class="chapter  " data-progress="2.2" style="left: 12.857142857142858%;"></a>
    
        <a href="../demarrage_rapide/rudiments_de_git.html" title="Rudiments de Git" class="chapter  " data-progress="2.3" style="left: 14.285714285714286%;"></a>
    
        <a href="../demarrage_rapide/installation_de_git.html" title="Installation de Git" class="chapter  " data-progress="2.4" style="left: 15.714285714285714%;"></a>
    
        <a href="../demarrage_rapide/parametrage_a_la_premiere_utilisation_de_git.html" title="Paramétrage à la première utilisation de Git" class="chapter  " data-progress="2.5" style="left: 17.142857142857142%;"></a>
    
        <a href="../demarrage_rapide/obtenir_de_laide.html" title="Obtenir de l&#39;aide" class="chapter  " data-progress="2.6" style="left: 18.571428571428573%;"></a>
    
        <a href="../demarrage_rapide/resume.html" title="Résumé" class="chapter  " data-progress="2.7" style="left: 20%;"></a>
    
        <a href="../les_branches_avec_git/README.html" title="Les branches avec Git" class="chapter  new-chapter" data-progress="3" style="left: 21.428571428571427%;"></a>
    
        <a href="../les_branches_avec_git/ce_quest_une_branche.html" title="Ce qu&#39;est une branche" class="chapter  " data-progress="3.1" style="left: 22.857142857142858%;"></a>
    
        <a href="../les_branches_avec_git/brancher_et_fusionner_les_bases.html" title="Brancher et fusionner : les bases" class="chapter  " data-progress="3.2" style="left: 24.285714285714285%;"></a>
    
        <a href="../les_branches_avec_git/gestion_de_branches.html" title="Gestion de branches" class="chapter  " data-progress="3.3" style="left: 25.714285714285715%;"></a>
    
        <a href="../les_branches_avec_git/travailler_avec_les_branches.html" title="Travailler avec les branches" class="chapter  " data-progress="3.4" style="left: 27.142857142857142%;"></a>
    
        <a href="../les_branches_avec_git/les_branches_distantes.html" title="Les branches distantes" class="chapter  " data-progress="3.5" style="left: 28.571428571428573%;"></a>
    
        <a href="../les_branches_avec_git/rebaser.html" title="Rebaser" class="chapter  " data-progress="3.6" style="left: 30%;"></a>
    
        <a href="../les_branches_avec_git/resume.html" title="Résumé" class="chapter  " data-progress="3.7" style="left: 31.428571428571427%;"></a>
    
        <a href="../git_sur_le_serveur/README.html" title="Git sur le serveur" class="chapter  new-chapter" data-progress="4" style="left: 32.857142857142854%;"></a>
    
        <a href="../git_sur_le_serveur/protocoles.html" title="Protocoles" class="chapter  " data-progress="4.1" style="left: 34.285714285714285%;"></a>
    
        <a href="../git_sur_le_serveur/git_heberge.html" title="Git hébergé" class="chapter  " data-progress="4.10" style="left: 35.714285714285715%;"></a>
    
        <a href="../git_sur_le_serveur/resume.html" title="Résumé" class="chapter  " data-progress="4.11" style="left: 37.142857142857146%;"></a>
    
        <a href="../git_sur_le_serveur/installation_de_git_sur_un_serveur.html" title="Installation de Git sur un serveur" class="chapter  " data-progress="4.2" style="left: 38.57142857142857%;"></a>
    
        <a href="../git_sur_le_serveur/generation_des_cles_publiques_ssh.html" title="Génération des clés publiques SSH" class="chapter  " data-progress="4.3" style="left: 40%;"></a>
    
        <a href="../git_sur_le_serveur/mise_en_place_du_serveur.html" title="Mise en place du serveur" class="chapter  " data-progress="4.4" style="left: 41.42857142857143%;"></a>
    
        <a href="../git_sur_le_serveur/acces_public.html" title="Accès public" class="chapter  " data-progress="4.5" style="left: 42.857142857142854%;"></a>
    
        <a href="../git_sur_le_serveur/gitweb.html" title="GitWeb" class="chapter  " data-progress="4.6" style="left: 44.285714285714285%;"></a>
    
        <a href="../git_sur_le_serveur/gitosis.html" title="Gitosis" class="chapter  " data-progress="4.7" style="left: 45.714285714285715%;"></a>
    
        <a href="../git_sur_le_serveur/gitolite.html" title="Gitolite" class="chapter  " data-progress="4.8" style="left: 47.142857142857146%;"></a>
    
        <a href="../git_sur_le_serveur/le_daemon_git.html" title="Le *daemon* Git" class="chapter  " data-progress="4.9" style="left: 48.57142857142857%;"></a>
    
        <a href="../git_distribue/README.html" title="Git distribué" class="chapter  new-chapter" data-progress="5" style="left: 50%;"></a>
    
        <a href="../git_distribue/developpements_distribues.html" title="Développements distribués" class="chapter  " data-progress="5.1" style="left: 51.42857142857143%;"></a>
    
        <a href="../git_distribue/contribution_a_un_projet.html" title="Contribution à un projet" class="chapter  " data-progress="5.2" style="left: 52.857142857142854%;"></a>
    
        <a href="../git_distribue/maintenance_dun_projet.html" title="Maintenance d&#39;un projet" class="chapter  " data-progress="5.3" style="left: 54.285714285714285%;"></a>
    
        <a href="../git_distribue/resume.html" title="Résumé" class="chapter  " data-progress="5.4" style="left: 55.714285714285715%;"></a>
    
        <a href="../utilitaires_git/README.html" title="Utilitaires Git" class="chapter  new-chapter" data-progress="6" style="left: 57.142857142857146%;"></a>
    
        <a href="../utilitaires_git/selection_des_versions.html" title="Sélection des versions" class="chapter  " data-progress="6.1" style="left: 58.57142857142857%;"></a>
    
        <a href="../utilitaires_git/indexation_interactive.html" title="Indexation interactive" class="chapter  " data-progress="6.2" style="left: 60%;"></a>
    
        <a href="../utilitaires_git/le_remisage.html" title="Le remisage" class="chapter  " data-progress="6.3" style="left: 61.42857142857143%;"></a>
    
        <a href="../utilitaires_git/reecrire_lhistorique.html" title="Réécrire l&#39;historique" class="chapter  " data-progress="6.4" style="left: 62.857142857142854%;"></a>
    
        <a href="../utilitaires_git/deboguer_avec_git.html" title="Deboguer avec Git" class="chapter  " data-progress="6.5" style="left: 64.28571428571429%;"></a>
    
        <a href="../utilitaires_git/sous_modules.html" title="Sous-modules" class="chapter  " data-progress="6.6" style="left: 65.71428571428571%;"></a>
    
        <a href="../utilitaires_git/fusion_de_sous_arborescences.html" title="Fusion de sous-arborescences" class="chapter  " data-progress="6.7" style="left: 67.14285714285714%;"></a>
    
        <a href="../utilitaires_git/resume.html" title="Résumé" class="chapter  " data-progress="6.8" style="left: 68.57142857142857%;"></a>
    
        <a href="../les_bases_de_git/README.html" title="Les bases de Git" class="chapter  new-chapter" data-progress="7" style="left: 70%;"></a>
    
        <a href="../les_bases_de_git/demarrer_un_depot_git.html" title="Démarrer un dépôt Git" class="chapter  " data-progress="7.1" style="left: 71.42857142857143%;"></a>
    
        <a href="../les_bases_de_git/enregistrer_des_modifications_dans_le_depot.html" title="Enregistrer des modifications dans le dépôt" class="chapter  " data-progress="7.2" style="left: 72.85714285714286%;"></a>
    
        <a href="../les_bases_de_git/visualiser_lhistorique_des_validations.html" title="Visualiser l&#39;historique des validations" class="chapter  " data-progress="7.3" style="left: 74.28571428571429%;"></a>
    
        <a href="../les_bases_de_git/annuler_des_actions.html" title="Annuler des actions" class="chapter  " data-progress="7.4" style="left: 75.71428571428571%;"></a>
    
        <a href="../les_bases_de_git/travailler_avec_des_depots_distants.html" title="Travailler avec des dépôts distants" class="chapter  " data-progress="7.5" style="left: 77.14285714285714%;"></a>
    
        <a href="../les_bases_de_git/etiquetage.html" title="Étiquetage" class="chapter  " data-progress="7.6" style="left: 78.57142857142857%;"></a>
    
        <a href="../les_bases_de_git/trucs_et_astuces.html" title="Trucs et astuces" class="chapter  " data-progress="7.7" style="left: 80%;"></a>
    
        <a href="../les_bases_de_git/resume.html" title="Résumé" class="chapter  " data-progress="7.8" style="left: 81.42857142857143%;"></a>
    
        <a href="../git_et_les_autres_systemes/README.html" title="Git et les autres systèmes" class="chapter  new-chapter" data-progress="8" style="left: 82.85714285714286%;"></a>
    
        <a href="../git_et_les_autres_systemes/git_et_subversion.html" title="Git et Subversion" class="chapter  " data-progress="8.1" style="left: 84.28571428571429%;"></a>
    
        <a href="../git_et_les_autres_systemes/migrer_sur_git.html" title="Migrer sur Git" class="chapter  " data-progress="8.2" style="left: 85.71428571428571%;"></a>
    
        <a href="../git_et_les_autres_systemes/resume.html" title="Résumé" class="chapter  " data-progress="8.3" style="left: 87.14285714285714%;"></a>
    
        <a href="../les_tripes_de_git/README.html" title="Les tripes de Git" class="chapter  new-chapter" data-progress="9" style="left: 88.57142857142857%;"></a>
    
        <a href="../les_tripes_de_git/plomberie_et_porcelaine.html" title="Plomberie et porcelaine" class="chapter  " data-progress="9.1" style="left: 90%;"></a>
    
        <a href="../les_tripes_de_git/les_objets_git.html" title="Les objets Git" class="chapter  " data-progress="9.2" style="left: 91.42857142857143%;"></a>
    
        <a href="../les_tripes_de_git/references_git.html" title="Références Git" class="chapter  " data-progress="9.3" style="left: 92.85714285714286%;"></a>
    
        <a href="../les_tripes_de_git/fichiers_groupes.html" title="Fichiers groupés" class="chapter  " data-progress="9.4" style="left: 94.28571428571429%;"></a>
    
        <a href="../les_tripes_de_git/les_references_specifiques.html" title="Les références spécifiques" class="chapter  " data-progress="9.5" style="left: 95.71428571428571%;"></a>
    
        <a href="../les_tripes_de_git/protocoles_de_transfert.html" title="Protocoles de transfert" class="chapter  " data-progress="9.6" style="left: 97.14285714285714%;"></a>
    
        <a href="../les_tripes_de_git/maintenance_et_recuperation_de_donnees.html" title="Maintenance et récupération de données" class="chapter  " data-progress="9.7" style="left: 98.57142857142857%;"></a>
    
        <a href="../les_tripes_de_git/resume.html" title="Résumé" class="chapter  " data-progress="9.8" style="left: 100%;"></a>
    
    </div>
</div>

                <div class="page-inner">
                
                    <section class="normal" id="section-gitbook_661">
                    
                        <h1 id="exemple-de-politique-g-r-e-par-git">Exemple de politique gérée par Git</h1>
<p>Dans ce chapitre, nous allons utiliser ce que nous venons d&#39;apprendre pour installer une gestion Git qui vérifie la présence d&#39;un format personnalisé de message de validation, n&#39;autorise que les poussées en avance rapide et autorise seulement certains utilisateurs à modifier certains sous-répertoires dans un projet.
Nous construirons des scripts client pour informer les développeurs que leurs poussées vont être rejetées et des scripts sur le serveur pour mettre effectivement en place ces règles.</p>
<p>J&#39;ai utilisé Ruby pour les écrire, d&#39;abord parce que c&#39;est mon langage de script favori, ensuite parce que je pense que c&#39;est le langage de script qui s&#39;apparente le plus à du pseudo-code.
Ainsi, il devrait être simple de suivre grossièrement le code même sans connaître le langage Ruby.
Cependant, tout langage peut être utilisé.
Tous les scripts d&#39;exemple distribués avec Git sont soit en Perl soit en Bash, ce qui donne de nombreux autres exemples de crochets dans ces langages.</p>
<h2 id="crochets-c-t-serveur">Crochets côté serveur</h2>
<p>Toutes les actions côté serveur seront contenues dans le fichier <code>update</code> dans le répertoire <code>hooks</code>.
Le fichier <code>update</code> s&#39;exécute une fois par branche poussée et accepte comme paramètre la référence sur laquelle on pousse, l&#39;ancienne révision de la branche et la nouvelle révision de la branche.
Vous pouvez aussi avoir accès à l&#39;utilisateur qui pousse si la poussée est réalisée par SSH.
Si vous avez permis à tout le monde de se connecter avec un utilisateur unique (comme « git ») avec une authentification à clé publique, il vous faudra fournir à cet utilisateur une enveloppe de shell qui déterminera l&#39;identité de l&#39;utilisateur à partir de sa clé publique et positionnera une variable d&#39;environnement spécifiant cette identité.
Ici, je considère que la variable d&#39;environnement <code>$USER</code> indique l&#39;utilisateur connecté, donc le script update commence par rassembler toutes les informations nécessaires :</p>
<pre><code><span class="hljs-comment">#!/usr/bin/env ruby</span>

<span class="hljs-variable">$nomref</span>       = <span class="hljs-constant">ARGV</span>[<span class="hljs-number">0</span>]
<span class="hljs-variable">$anciennerev</span>  = <span class="hljs-constant">ARGV</span>[<span class="hljs-number">1</span>]
<span class="hljs-variable">$nouvellerev</span>  = <span class="hljs-constant">ARGV</span>[<span class="hljs-number">2</span>]
<span class="hljs-variable">$utilisateur</span>  = <span class="hljs-constant">ENV</span>[<span class="hljs-string">'USER'</span>]

puts <span class="hljs-string">"Vérification des règles... \n(<span class="hljs-subst">#{<span class="hljs-variable">$nomref</span>}</span>) (<span class="hljs-subst">#{<span class="hljs-variable">$anciennerev</span>[<span class="hljs-number">0</span>,<span class="hljs-number">6</span>]}</span>) (<span class="hljs-subst">#{<span class="hljs-variable">$nouvellerev</span>[<span class="hljs-number">0</span>,<span class="hljs-number">6</span>]}</span>)"</span>
</code></pre><p>Et oui, j&#39;utilise des variables globales.
C&#39;est seulement pour simplifier la démonstration.</p>
<h3 id="application-d-une-politique-de-format-du-message-de-validation">Application d&#39;une politique de format du message de validation</h3>
<p>Notre première tâche consiste à forcer que chaque message de validation adhère à un format particulier.
En guise d&#39;objectif, obligeons chaque message à contenir une chaîne de caractère qui ressemble à « ref: 1234 » parce que nous souhaitons que chaque validation soit liée à une tâche de notre système de tickets.
Nous devons donc inspecter chaque <em>commit</em> poussé, vérifier la présence de la chaîne et sortir avec un code non-nul en cas d&#39;absence pour rejeter la poussée.</p>
<p>Vous pouvez obtenir une liste des valeurs SHA-1 de tous les <em>commits</em> en cours de poussée en passant les valeurs <code>$nouvellerev</code> et <code>$anciennerev</code> à une commande de plomberie Git appelée <code>git-rev-list</code>.
C&#39;est comme la commande <code>git log</code> mais elle n&#39;affiche par défaut que les valeurs SHA-1, sans autre information.
Donc, pour obtenir une liste de tous les SHA des <em>commits</em> introduits entre un SHA de <em>commit</em> et un autre, il suffit de lancer quelque chose comme :</p>
<pre><code>$ git rev-<span class="hljs-built_in">list</span> <span class="hljs-number">538</span>c33..d14fc7
d14fc7c847ab946ec39590d87783c69b031bdfb7
<span class="hljs-number">9f</span>585da4401b0a3999e84113824d15245c13f0be
<span class="hljs-number">234071</span>a1be950e2a8d078e6141f5cd20c1e61ad3
dfa04c9ef3d5197182f13fb5b9b1fb7717d2222a
<span class="hljs-number">17716</span>ec0f1ff5c77eff40b7fe912f9f6cfd0e475
</code></pre><p>Vous pouvez récupérer la sortie, boucler sur chacun de ces SHA de <em>commit</em>, en extraire le message et tester la conformité du message avec une structure au moyen d&#39;une expression rationnelle.</p>
<p>Vous devez trouver comment extraire le message de validation à partir de chacun des <em>commits</em> à tester.
Pour accéder aux données brutes du <em>commit</em>, vous pouvez utiliser une autre commande de plomberie appelée <code>git cat-file</code>.
Nous traiterons en détail toutes ces commandes de plomberie au chapitre 9 mais pour l&#39;instant, voici ce que cette commande affiche:</p>
<pre><code>$ git cat-<span class="hljs-built_in">file</span> commit ca82a6
tree cfda3bf379e4f8dba8717dee55aab78aef7f4daf
parent <span class="hljs-number">085</span>bb3bcb608e1e8451d4b2432f8ecbe6306e7e7
author Scott Chacon &lt;schacon@gmail.com&gt; <span class="hljs-number">1205815931</span> -<span class="hljs-number">0700</span>
committer Scott Chacon &lt;schacon@gmail.com&gt; <span class="hljs-number">1240030591</span> -<span class="hljs-number">0700</span>

changed <span class="hljs-operator">the</span> <span class="hljs-built_in">version</span> <span class="hljs-built_in">number</span>
</code></pre><p>Un moyen simple d&#39;extraire le message de validation d&#39;un <em>commit</em> à partir de son SHA-1 consiste à rechercher la première ligne vide et à sélectionner tout ce qui suit.
Cela peut être facilement réalisé avec la commande <code>sed</code> sur les systèmes Unix :</p>
<pre><code>$ git cat-<span class="hljs-built_in">file</span> commit ca82a6 | sed <span class="hljs-string">'1,/^$/d'</span>
changed <span class="hljs-operator">the</span> <span class="hljs-built_in">version</span> <span class="hljs-built_in">number</span>
</code></pre><p>Vous pouvez utiliser cette ligne pour récupérer le message de validation de chaque <em>commit</em> en cours de poussée et sortir si quelque chose ne correspond à ce qui est attendu.
Pour sortir du script et rejeter la poussée, il faut sortir avec un code non nul.
La fonction complète ressemble à ceci :</p>
<pre><code>$regex = /\[ref: (\d+)\]/

<span class="hljs-comment"># vérification du format des messages de validation</span>
def verif_format_message
  revs_manquees = `git rev-list <span class="hljs-comment">#{$anciennerev}..#{$nouvellerev}`.split("\n")</span>
  revs_manquees.<span class="hljs-keyword">each</span> <span class="hljs-built_in">do</span> |rev|
    message = `git cat-<span class="hljs-built_in">file</span> commit <span class="hljs-comment">#{rev} | sed '1,/^$/d'`</span>
    <span class="hljs-keyword">if</span> !$regex.match(message)
      puts <span class="hljs-string">"[REGLE] Le message de validation n'est pas conforme"</span>
      exit <span class="hljs-number">1</span>
    <span class="hljs-function"><span class="hljs-keyword">end</span></span>
  <span class="hljs-function"><span class="hljs-keyword">end</span></span>
<span class="hljs-function"><span class="hljs-keyword">end</span></span>
verif_format_message
</code></pre><p>Placer ceci dans un script <code>update</code> rejettera les mises à jour contenant des <em>commits</em> dont les messages ne suivent pas la règle.</p>
<h3 id="mise-en-place-d-un-syst-me-d-acl-par-utilisateur">Mise en place d&#39;un système d&#39;ACL par utilisateur</h3>
<p>Supposons que vous souhaitiez ajouter un mécanisme à base de liste de contrôle d&#39;accès (access control list : ACL) qui permette de spécifier quel utilisateur a le droit de pousser des modifications vers quelle partie du projet.
Certaines personnes ont un accès complet tandis que d&#39;autres n&#39;ont accès que pour mettre à jour certains sous-répertoires ou certains fichiers.
Pour faire appliquer ceci, nous allons écrire ces règles dans un fichier appelé <code>acl</code> situé dans le dépôt brut Git sur le serveur.
Le crochet <code>update</code> examinera ces règles, listera les fichiers impactés par la poussée et déterminera si l&#39;utilisateur qui pousse a effectivement les droits nécessaires sur ces fichiers.</p>
<p>Écrivons en premier le fichier d&#39;ACL.
Nous allons utiliser un format très proche de celui des ACL de CVS.
Le fichier est composé de lignes dont le premier champ est <code>avail</code> ou <code>unavail</code>, le second est une liste des utilisateurs concernés séparés par des virgules et le dernier champ indique le chemin pour lequel la règle s&#39;applique (le champ vide indiquant une règle générale).
Tous les champs sont délimités par un caractère pipe « | ».</p>
<p>Dans notre cas, il y a quelques administrateurs, des auteurs de documentation avec un accès au répertoire <code>doc</code> et un développeur qui n&#39;a accès qu&#39;aux répertoires <code>lib</code> et <code>tests</code>.
Le fichier ACL ressemble donc à ceci :</p>
<pre><code>avail|nickh,pjhyett,defunkt,tpw
avail|usinclair,cdickens,ebronte|doc
avail<span class="hljs-localvars">|schacon|lib
avail|schacon|tests</span>
</code></pre><p>Le traitement consiste à lire le fichier dans une structure utilisable.
Dans notre cas, pour simplifier, nous ne traiterons que les directives <code>avail</code>.
Voici une fonction qui crée à partir du fichier un tableau associatif dont la clé est l&#39;utilisateur et la valeur est une liste des chemins pour lesquels l&#39;utilisateur a les droits en écriture :</p>
<pre><code>def get_acl_access_data(nom_fichier_acl)
  <span class="hljs-comment"># lire le fichier ACL</span>
  fichier_acl = File.<span class="hljs-built_in">read</span>(nom_fichier_acl).<span class="hljs-built_in">split</span>(<span class="hljs-string">"\n"</span>).reject { |ligne| ligne == <span class="hljs-string">''</span> }
  acces = {}
  fichier_acl.<span class="hljs-keyword">each</span> <span class="hljs-built_in">do</span> |ligne|
    avail, utilisateurs, chemin = ligne.<span class="hljs-built_in">split</span>(<span class="hljs-string">'|'</span>)
    next unless avail == <span class="hljs-string">'avail'</span>
    utilisateurs.<span class="hljs-built_in">split</span>(<span class="hljs-string">','</span>).<span class="hljs-keyword">each</span> <span class="hljs-built_in">do</span> |utilisateur|
      acces[utilisateur] ||= []
      acces[utilisateur] &lt;&lt; chemin
    <span class="hljs-function"><span class="hljs-keyword">end</span></span>
  <span class="hljs-function"><span class="hljs-keyword">end</span></span>
  acces
<span class="hljs-function"><span class="hljs-keyword">end</span></span>
</code></pre><p>Pour le fichier d&#39;ACL décrit plus haut, le fonction <code>get_acl_access_data</code> retourne une structure de données qui ressemble à ceci :</p>
<pre><code>{<span class="hljs-string">"defunkt"</span>=&gt;[nil],
 <span class="hljs-string">"tpw"</span>=&gt;[nil],
 <span class="hljs-string">"nickh"</span>=&gt;[nil],
 <span class="hljs-string">"pjhyett"</span>=&gt;[nil],
 <span class="hljs-string">"schacon"</span>=&gt;[<span class="hljs-string">"lib"</span>, <span class="hljs-string">"tests"</span>],
 <span class="hljs-string">"cdickens"</span>=&gt;[<span class="hljs-string">"doc"</span>],
 <span class="hljs-string">"usinclair"</span>=&gt;[<span class="hljs-string">"doc"</span>],
 <span class="hljs-string">"ebronte"</span>=&gt;[<span class="hljs-string">"doc"</span>]}
</code></pre><p>En plus des permissions, il faut déterminer les chemins impactés par la poussée pour s&#39;assurer que l&#39;utilisateur a bien droit d&#39;y toucher.</p>
<p>La liste des fichiers modifiés est assez simplement obtenue par la commande <code>git log</code> complétée par l&#39;option <code>--name-only</code> mentionnée au chapitre 2.</p>
<pre><code>$ git <span class="hljs-built_in">log</span> -<span class="hljs-number">1</span> --name-only --pretty=<span class="hljs-built_in">format</span>:<span class="hljs-string">''</span> <span class="hljs-number">9</span>f585d

README
lib/test.rb
</code></pre><p>Chaque fichier des <em>commits</em> doit être vérifié par rapport à la structure ACL retournée par la fonction <code>get_acl_access_data</code> pour déterminer si l&#39;utilisateur a le droit de pousser tous ses <em>commits</em> :</p>
<pre><code><span class="hljs-comment"># permission à certains utilisateurs de modifier certains sous-répertoires du projet</span>
def verif_perms_repertoire
  acces = get_acl_access_data(<span class="hljs-string">'acl'</span>)

  <span class="hljs-comment"># verifier si quelqu'un chercher à pousser où il n'a pas le droit</span>
  nouveaux_commits = `git rev-list <span class="hljs-comment">#{$anciennerev}..#{$nouvellerev}`.split("\n")</span>
  nouveaux_commits.<span class="hljs-keyword">each</span> <span class="hljs-built_in">do</span> |rev|
    fichiers_modifies = `git <span class="hljs-built_in">log</span> -<span class="hljs-number">1</span> <span class="hljs-comment">--name-only --pretty=format:'' #{rev}`.split("\n")</span>
    fichiers_modifies.<span class="hljs-keyword">each</span> <span class="hljs-built_in">do</span> |chemin|
      next <span class="hljs-keyword">if</span> chemin.size == <span class="hljs-number">0</span>
      acces_permis = <span class="hljs-constant">false</span>
      acces[$utilisateur].<span class="hljs-keyword">each</span> <span class="hljs-built_in">do</span> |chemin_acces|
        <span class="hljs-keyword">if</span> !chemin_acces || <span class="hljs-comment"># l'utilisateur a un accès complet</span>
          (chemin.index(chemin_acces) == <span class="hljs-number">0</span>) <span class="hljs-comment"># acces à ce chemin</span>
          acces_permis = <span class="hljs-constant">true</span>
        <span class="hljs-function"><span class="hljs-keyword">end</span></span>
      <span class="hljs-function"><span class="hljs-keyword">end</span></span>
      <span class="hljs-keyword">if</span> !acces_permis
        puts <span class="hljs-string">"[ACL] Vous n'avez pas le droit de pousser sur #{path}"</span>
        exit <span class="hljs-number">1</span>
      <span class="hljs-function"><span class="hljs-keyword">end</span></span>
    <span class="hljs-function"><span class="hljs-keyword">end</span></span>
  <span class="hljs-function"><span class="hljs-keyword">end</span></span>
<span class="hljs-function"><span class="hljs-keyword">end</span></span>

verif_perms_repertoire
</code></pre><p>L&#39;algorithme ci-dessus reste simple.
Pour chaque élément de la liste des nouveaux <em>commits</em> à pousser obtenue au moyen de <code>git rev-list</code>, on vérifie que l&#39;utilisateur qui pousse a accès au chemin de chacun des fichiers modifiés.
L&#39;expression <code>chemin.index(chemin_acces) == 0</code> est un Rubyisme qui n&#39;est vrai que si <code>chemin</code> commence comme <code>chemin_acces</code>.
Ce script s&#39;assure non pas qu&#39;un <code>chemin</code> fait partie des chemins permis, mais que tous les chemins accédés font bien partie des chemins permis.</p>
<p>À présent, les utilisateurs ne peuvent plus pousser de <em>commits</em> comprenant un message incorrectement formaté ou des modifications à des fichiers hors de leur zone réservée.</p>
<h3 id="application-des-pouss-es-en-avance-rapide">Application des poussées en avance rapide</h3>
<p>Il ne reste plus qu&#39;à forcer les poussées en avance rapide uniquement.
À partir de la version 1.6, les paramètres <code>receive.denyDeletes</code> et <code>receive.denyNonFastForwards</code> règlent le problème.
Cependant, l&#39;utilisation d&#39;un crochet permet de fonctionner avec des versions antérieures de Git et même après modification, des permissions par utilisateur ou toute autre évolution.</p>
<p>L&#39;algorithme consiste à vérifier s&#39;il y a des <em>commits</em> accessibles depuis l&#39;ancienne révision qui ne sont pas accessibles depuis la nouvelle.
S&#39;il n&#39;y en a aucun alors la poussée est effectivement en avance rapide.
Sinon, il faut le rejeter :</p>
<pre><code><span class="hljs-comment"># Forcer les poussées qu'en avance rapide</span>
def verif_avance_rapide
  refs_manquees = `git rev-list <span class="hljs-comment">#{$nouvellerev}..#{$anciennerev}`</span>
  nb_refs_manquees = refs_manquees.<span class="hljs-built_in">split</span>(<span class="hljs-string">"\n"</span>).size
  <span class="hljs-keyword">if</span> nb_refs_manquees &gt; <span class="hljs-number">0</span>
    puts <span class="hljs-string">"[REGLE] Poussée en avance rapide uniquement"</span>
    exit <span class="hljs-number">1</span>
  <span class="hljs-function"><span class="hljs-keyword">end</span></span>
<span class="hljs-function"><span class="hljs-keyword">end</span></span>

verif_avance_rapide
</code></pre><p>Tout est en place.
En lançant <code>chmod u+x .git/hooks/update</code>, <code>update</code> étant le fichier dans lequel tout le code précédent réside, puis en essayant de pousser une référence qui n&#39;est pas en avance rapide, on obtient ceci :</p>
<pre><code>$ git push -f origin master
Counting objects: <span class="hljs-number">5</span>, done.
Compressing objects: <span class="hljs-number">100</span>% (<span class="hljs-number">3</span>/<span class="hljs-number">3</span>), done.
Writing objects: <span class="hljs-number">100</span>% (<span class="hljs-number">3</span>/<span class="hljs-number">3</span>), <span class="hljs-number">323</span> bytes, done.
Total <span class="hljs-number">3</span> (delta <span class="hljs-number">1</span>), reused <span class="hljs-number">0</span> (delta <span class="hljs-number">0</span>)
Unpacking objects: <span class="hljs-number">100</span>% (<span class="hljs-number">3</span>/<span class="hljs-number">3</span>), done.
Vérification des règles...
(refs/heads/master) (<span class="hljs-number">8338</span>c5) (c5b616)
[REGLE] Poussée en avance rapide uniquement
<span class="hljs-keyword">error</span>: hooks/update exited <span class="hljs-keyword">with</span> <span class="hljs-keyword">error</span> code <span class="hljs-number">1</span>
<span class="hljs-keyword">error</span>: hook declined <span class="hljs-keyword">to</span> update refs/heads/master
<span class="hljs-keyword">To</span> git@gitserver:project.git
 ! [remote rejected] master -&gt; master (hook declined)
<span class="hljs-keyword">error</span>: failed <span class="hljs-keyword">to</span> push some refs <span class="hljs-keyword">to</span> <span class="hljs-comment">'git@gitserver:project.git'</span>
</code></pre><p>Il y a plusieurs points à relever ici.
Premièrement, une ligne indique l&#39;endroit où le crochet est appelé.</p>
<pre><code>Vérification des règles<span class="hljs-attribute">...</span>
(refs/heads/master) (<span class="hljs-number">8338</span>c5) (c5b616)
</code></pre><p>Le script <code>update</code> affiche ces lignes sur stdout au tout début.
Tout ce que le script écrit sur stdout sera transmis au client.</p>
<p>La ligne suivante à remarquer est le message d&#39;erreur.</p>
<pre><code>[REGLE] Poussée en avance rapide uniquement
<span class="hljs-keyword">error</span>: hooks/update exited <span class="hljs-keyword">with</span> <span class="hljs-keyword">error</span> code <span class="hljs-number">1</span>
<span class="hljs-keyword">error</span>: hook declined <span class="hljs-keyword">to</span> update refs/heads/master
</code></pre><p>Le première ligne a été écrite par le script, les deux autres l&#39;ont été par Git pour indiquer que le script <code>update</code> a rendu un code de sortie non nul, ce qui a causé l&#39;échec de la poussée.
Enfin, il y a ces lignes :</p>
<pre><code><span class="hljs-keyword">To</span> git@gitserver:project.git
 ! [remote rejected] master -&gt; master (hook declined)
<span class="hljs-keyword">error</span>: failed <span class="hljs-keyword">to</span> push some refs <span class="hljs-keyword">to</span> <span class="hljs-comment">'git@gitserver:project.git'</span>
</code></pre><p>Il y a un message d&#39;échec distant pour chaque référence que le crochet a rejetée et une indication que l&#39;échec est dû spécifiquement à un échec du crochet.</p>
<p>Par ailleurs, si le marqueur <code>ref</code> n&#39;est pas présent dans le message de validation, le message d&#39;erreur spécifique est affiché :</p>
<pre><code>[REGLE] Le message de validation n<span class="hljs-comment">'est pas conforme</span>
</code></pre><p>Ou si quelqu&#39;un cherche à modifier un fichier auquel il n&#39;a pas les droits d&#39;accès lors d&#39;une poussée, il verra quelque chose de similaire.
Par exemple, si un auteur de documentation essaie de pousser un <em>commit</em> qui modifie quelque chose dans le répertoire <code>lib</code>, il verra :</p>
<pre><code>[ACL] Vous n<span class="hljs-comment">'avez pas le droit de pousser sur lib/test.rb</span>
</code></pre><p>C&#39;est tout.
À partir de maintenant, tant que le script <code>update</code> est en place et exécutable, votre dépôt ne peut plus subir de poussées hors avancée rapide, n&#39;accepte plus de messages sans format et vos utilisateurs sont bridés.</p>
<h2 id="crochets-c-t-client">Crochets côté client</h2>
<p>Le problème de cette approche, ce sont les plaintes des utilisateurs qui résulteront inévitablement des échecs de leurs poussées.
Leur frustration et leur confusion devant le rejet à la dernière minute d&#39;un travail minutieux est tout à fait compréhensible.
De plus, la correction nécessitera  une modification de leur historique, ce qui n&#39;est pas une partie de plaisir.</p>
<p>Pour éviter ce scénario, il faut pouvoir fournir aux utilisateurs des crochets côté client qui leur permettront de vérifier que leurs validations seront effectivement acceptées par le serveur.
Ainsi, ils pourront corriger les problèmes avant de valider et avant que ces difficultés ne deviennent des casse-têtes.
Ces scripts n&#39;étant pas diffusés lors du clonage du projet, il vous faudra les distribuer d&#39;une autre manière, puis indiquer aux utilisateurs de les copier dans leur répertoire <code>.git/hooks</code> et de les rendre exécutables.
Vous pouvez distribuer ces crochets au sein du projet ou dans un projet annexe mais il n&#39;y a aucun moyen de les mettre en place automatiquement.</p>
<p>Premièrement, pour éviter le rejet du serveur au motif d&#39;un mauvais format du message de validation, il faut vérifier celui-ci avant que chaque <em>commit</em> ne soit enregistré.
Pour ce faire, utilisons le crochet <code>commit-msg</code>.
En lisant le message à partir du fichier passé en premier argument et en le comparant au format attendu, on peut forcer Git à abandonner la validation en cas d&#39;absence de correspondance :</p>
<pre><code><span class="hljs-shebang">#!/usr/bin/env ruby</span>
fichier_message = ARGV[<span class="hljs-number">0</span>]
message = File.read(fichier_message)

$regex = /\[<span class="hljs-keyword">ref</span>: (\d+)\]/

<span class="hljs-keyword">if</span> !$regex.match(message)
  puts <span class="hljs-string">"[REGLE] Le message de validation ne suit pas le format"</span>
  exit <span class="hljs-number">1</span>
end
</code></pre><p>Avec ce fichier exécutable et à sa place dans <code>.git/hooks/commit-msg</code>, si une validation avec un message incorrect est tentée, voici le résultat :</p>
<pre><code>$ git commit -am <span class="hljs-string">'test'</span>
[REGLE] Le message de validation <span class="hljs-keyword">ne</span> suit pas le <span class="hljs-keyword">format</span>
</code></pre><p>La validation n&#39;a pas abouti.
Néanmoins, si le message contient la bonne forme, Git accepte la validation :</p>
<pre><code>$ git commit -am <span class="hljs-string">'test [ref: 132]'</span>
[master e05c914] test [<span class="hljs-keyword">ref</span>: <span class="hljs-number">132</span>]
 <span class="hljs-number">1</span> files changed, <span class="hljs-number">1</span> insertions(+), <span class="hljs-number">0</span> deletions(-)
</code></pre><p>Ensuite, il faut s&#39;assurer des droits sur les fichiers modifiés.
Si le répertoire <code>.git</code> du projet contient une copie du fichier d&#39;ACL précédemment utilisé, alors le script <code>pre-commit</code> suivant appliquera ses règles :</p>
<pre><code><span class="hljs-comment">#!/usr/bin/env ruby</span>

$utilisateur    = ENV[<span class="hljs-string">'USER'</span>]

<span class="hljs-comment"># [ insérer la fonction acl_access_data method ci-dessus ]</span>

<span class="hljs-comment"># Ne permet qu'à certains utilisateurs de modifier certains sous-répertoires</span>
def verif_perms_repertoire
  acces = get_acl_access_data(<span class="hljs-string">'.git/acl'</span>)

  fichiers_modifies = `git diff-index <span class="hljs-comment">--cached --name-only HEAD`.split("\n")</span>
  fichiers_modifies.<span class="hljs-keyword">each</span> <span class="hljs-built_in">do</span> |chemin|
    next <span class="hljs-keyword">if</span> chemin.size == <span class="hljs-number">0</span>
    acces_permis = <span class="hljs-constant">false</span>
    acces[$utilisateur].<span class="hljs-keyword">each</span> <span class="hljs-built_in">do</span> |chemin_acces|
    <span class="hljs-keyword">if</span> !chemin_acces || (chemin.index(chemin_acces) == <span class="hljs-number">0</span>)
      acces_permis = <span class="hljs-constant">true</span>
    <span class="hljs-function"><span class="hljs-keyword">end</span></span>
    <span class="hljs-keyword">if</span> !acces_permis
      puts <span class="hljs-string">"[ACL] Vous n'avez pas le droit de pousser sur #{path}"</span>
      exit <span class="hljs-number">1</span>
    <span class="hljs-function"><span class="hljs-keyword">end</span></span>
  <span class="hljs-function"><span class="hljs-keyword">end</span></span>
<span class="hljs-function"><span class="hljs-keyword">end</span></span>

verif_perms_repertoire
</code></pre><p>C&#39;est grossièrement le même script que celui côté serveur, mais avec deux différences majeures.
Premièrement, le fichier ACL est à un endroit différent parce que le script s&#39;exécute depuis le copie de travail et non depuis le répertoire Git.
Il faut donc changer le chemin vers le fichier d&#39;ACL de :</p>
<pre><code>acces = get_acl_access_data(<span class="hljs-string">'acl'</span>)
</code></pre><p>en :</p>
<pre><code>acces = get_acl_access_data(<span class="hljs-string">'.git/acl'</span>)
</code></pre><p>L&#39;autre différence majeure réside dans la manière d&#39;obtenir la liste des fichiers modifiés.
La fonction sur le serveur la recherche dans le journal des <em>commits</em> mais comme dans le cas actuel, le <em>commit</em> n&#39;a pas encore été enregistré, il faut chercher la liste dans la zone d&#39;index.
Donc au lieu de :</p>
<pre><code>fichiers_modifies = `git <span class="hljs-built_in">log</span> -<span class="hljs-number">1</span> --name-only --pretty=<span class="hljs-built_in">format</span>:<span class="hljs-string">''</span> <span class="hljs-preprocessor">#{ref}`</span>
</code></pre><p>on utilise :</p>
<pre><code><span class="hljs-comment">fichiers_modifies</span> <span class="hljs-comment">=</span> <span class="hljs-comment">`git</span> <span class="hljs-comment">diff</span><span class="hljs-literal">-</span><span class="hljs-comment">index</span> <span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-comment">cached</span> <span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-comment">name</span><span class="hljs-literal">-</span><span class="hljs-comment">only</span> <span class="hljs-comment">HEAD`</span>
</code></pre><p>Mais à ces deux différences près, le script fonctionne de manière identique.
Ce script a aussi une autre limitation : il s&#39;attend à ce que l&#39;utilisateur qui le lance localement soit identique à celui sur le serveur distant.
S&#39;ils sont différents, il faudra positionner manuellement la variable <code>$utilisateur</code>.</p>
<p>La dernière action à réaliser consiste à vérifier que les références poussées sont bien en avance rapide, mais l&#39;inverse est plutôt rare.
Pour obtenir une référence qui n&#39;est pas en avance rapide, il faut soit rebaser après un <em>commit</em> qui a déjà été poussé, soit essayer de pousser une branche locale différente vers la même branche distante.</p>
<p>Comme le serveur indiquera qu&#39;on ne peut pas pousser sans avance rapide de toute façon et que le crochet empêche les poussées forcées, la seule action accidentelle qu&#39;il faut intercepter reste le rebasage de <em>commits</em> qui ont déjà été poussés.</p>
<p>Voici un exemple de script <code>pre-rebase</code> qui fait cette vérification.
Ce script récupère une liste de tous les <em>commits</em> qu&#39;on est sur le point de réécrire et vérifie s&#39;ils existent dans une référence distante.
S&#39;il en trouve un accessible depuis une des références distantes, il interrompt le rebasage :</p>
<pre><code><span class="hljs-comment">#!/usr/bin/env ruby</span>

branche_base = ARGV[<span class="hljs-number">0</span>]
<span class="hljs-keyword">if</span> ARGV[<span class="hljs-number">1</span>]
  branche_thematique = ARGV[<span class="hljs-number">1</span>]
<span class="hljs-keyword">else</span>
  branche_thematique = <span class="hljs-string">"HEAD"</span>
<span class="hljs-function"><span class="hljs-keyword">end</span></span>

sha_cibles = `git rev-list <span class="hljs-comment">#{branche_base}..#{branche_thematique}`.split("\n")</span>
refs_distantes = `git branch -r`.<span class="hljs-built_in">split</span>(<span class="hljs-string">"\n"</span>).map { |r| r.strip }

shas_cibles.<span class="hljs-keyword">each</span> <span class="hljs-built_in">do</span> |sha|
  refs_distantes.<span class="hljs-keyword">each</span> <span class="hljs-built_in">do</span> |ref_distante|
    shas_pousses = `git rev-list ^<span class="hljs-comment">#{sha}^@ refs/remotes/#{ref_distante}`</span>
    <span class="hljs-keyword">if</span> shas_pousses.<span class="hljs-built_in">split</span>(“\n”).<span class="hljs-built_in">include</span>?(sha)
      puts <span class="hljs-string">"[REGLE] Le commit #{sha} a déjà été poussé sur #{ref_distante}"</span>
      exit <span class="hljs-number">1</span>
    <span class="hljs-function"><span class="hljs-keyword">end</span></span>
  <span class="hljs-function"><span class="hljs-keyword">end</span></span>
<span class="hljs-function"><span class="hljs-keyword">end</span></span>
</code></pre><p>Ce script utilise une syntaxe qui n&#39;a pas été abordée à la section « sélection de révision » du chapitre 6.
La liste des <em>commits</em> déjà poussés est obtenue avec cette commande :</p>
<pre><code>git rev-list ^#{<span class="ruby">sha}</span>^@ refs/remotes/#{<span class="ruby">ref_distante}</span>
</code></pre><p>La syntaxe <code>SHA^@</code> fait référence à tous le parents du <em>commit</em>.
Les <em>commits</em> recherchés sont accessibles depuis le dernier <em>commit</em> distant et inaccessibles depuis n&#39;importe quel parent de n&#39;importe quel SHA qu&#39;on cherche à pousser.
C&#39;est la définition d&#39;avance rapide.</p>
<p>La limitation de cette approche reste qu&#39;elle peut s&#39;avérer très lente et non nécessaire.
Si vous n&#39;essayez pas de forcer à pousser avec l&#39;option <code>-f</code>, le serveur vous avertira et n&#39;acceptera pas la poussée.
Cependant, cela reste un exercice intéressant qui peut aider théoriquement à éviter un rebasage qui devra être annulé plus tard.</p>

                    
                    </section>
                
                </div>
            </div>
        </div>

        
        <a href="../personnalisation_de_git/crochets_git.html" class="navigation navigation-prev"><i class="fa fa-angle-left"></i></a>
        
        
        <a href="../personnalisation_de_git/resume.html" class="navigation navigation-next"><i class="fa fa-angle-right"></i></a>
        
    </div>
</div>

        
        <link rel="stylesheet" href="../gitbook/style.css">
        
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.1.3/ace.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.1.3/mode-javascript.js"></script>
        <script src="../gitbook/jsrepl/jsrepl.js" id="jsrepl-script"></script>
        <script src="../gitbook/app.js"></script>
        
    </body>
</html>
