<!DOCTYPE HTML>
<html lang="en-US">
    <head prefix="og: http://ogp.me/ns# book: http://ogp.me/ns/book#">
        
        <meta charset="UTF-8">
        <title>Um exemplo de Política Git Forçada | Learn Git</title>

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="robots" content="index, follow">
        <meta name="author" content="GitbookIO">
        <meta name="description" content="The entire Pro Git book.">
        <meta name="keywords" content="gitbook,github" >
        <meta name="generator" content="www.gitbook.io">

        
        <link rel="next" href="../customizando_o_git/sumario.html" />
        
        
        <link rel="prev" href="../customizando_o_git/hooks_do_git.html" />
        

        <meta property="og:title" content="Um exemplo de Política Git Forçada | Learn Git">
        <meta property="og:site_name" content="Learn Git">
        <meta property="og:type" content="book">
        <meta property="og:locale" content="en_US">

        <meta property="book:author" content="https://github.com/GitbookIO">
        <meta property="book:tag" content="GitBook">

        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">

        <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

        
        <link rel="stylesheet" href="../gitbook/style.css">
        
        
    </head>
    <body>
        
<div class="book" data-github="GitbookIO/git" data-level="7.4" data-basepath=".." data-revision="1396895631613">
    <div class="book-header">
    <!-- Actions Left -->
    <a href="https://github.com/GitbookIO/git" target="_blank" class="btn pull-left"><i class="fa fa-github-alt"></i></a>
    <a href="#" class="btn pull-left toggle-summary"><i class="fa fa-align-justify"></i></a>
    <a href="#" class="btn pull-left toggle-search"><i class="fa fa-search"></i></a>

    <!-- Actions Right -->
    <a href="#" target="_blank" class="btn pull-right" data-sharing="google-plus"><i class="fa fa-google-plus"></i></a>
    <a href="#" target="_blank" class="btn pull-right" data-sharing="facebook"><i class="fa fa-facebook"></i></a>
    <a href="#" target="_blank" class="btn pull-right" data-sharing="twitter"><i class="fa fa-twitter"></i></a>

    <a href="https://github.com/GitbookIO/git/stargazers" target="_blank" class="btn pull-right count-star"><i class="fa fa-star-o"></i> Star (<span>-</span>)</a>
    <a href="https://github.com/GitbookIO/git/watchers" target="_blank" class="btn pull-right count-watch"><i class="fa fa-eye"></i> Watch (<span>-</span>)</a>


    <!-- Title -->
    <h1><a href="../" >Learn Git</a></h1>
</div>

    <div class="book-summary">
    <div class="book-search">
        <input type="text" placeholder="Search" class="form-control" />
    </div>
    <ul class="summary">
        <li>
            <a href="https://github.com/GitbookIO" target="blank">About the author</a>
        </li>
        <li>
            <a href="https://github.com/GitbookIO/git/issues" target="blank">Questions and Issues</a>
        </li>
        <li>
            <a href="https://github.com/GitbookIO/git/edit/master/customizando_o_git/um_exemplo_de_politica_git_forcada.md" target="blank">Edit and Contribute</a>
        </li>
        <li class="divider"></li>
        <li data-level="0" data-path="index.html">
            <a href="../"><i class="fa fa-check"></i> Introduction</a>
        </li>
        
            <li  data-level="1" data-path="primeiros_passos/README.html">
                
                <a href="../primeiros_passos/README.html">
                    <i class="fa fa-check"></i> <b>1)</b> Primeiros passos
                </a>
                
                
                <ul class="articles">
                    
                        <li  data-level="1.1" data-path="primeiros_passos/sobre_controle_de_versao.html">
                            
                            <a href="../primeiros_passos/sobre_controle_de_versao.html">
                                <i class="fa fa-check"></i> <b>1.1)</b> Sobre Controle de Versão
                            </a>
                            
                        </li>
                    
                        <li  data-level="1.2" data-path="primeiros_passos/uma_breve_historia_do_git.html">
                            
                            <a href="../primeiros_passos/uma_breve_historia_do_git.html">
                                <i class="fa fa-check"></i> <b>1.2)</b> Uma Breve História do Git
                            </a>
                            
                        </li>
                    
                        <li  data-level="1.3" data-path="primeiros_passos/nocoes_basicas_de_git.html">
                            
                            <a href="../primeiros_passos/nocoes_basicas_de_git.html">
                                <i class="fa fa-check"></i> <b>1.3)</b> Noções Básicas de Git
                            </a>
                            
                        </li>
                    
                        <li  data-level="1.4" data-path="primeiros_passos/instalando_git.html">
                            
                            <a href="../primeiros_passos/instalando_git.html">
                                <i class="fa fa-check"></i> <b>1.4)</b> Instalando Git
                            </a>
                            
                        </li>
                    
                        <li  data-level="1.5" data-path="primeiros_passos/configuracao_inicial_do_git.html">
                            
                            <a href="../primeiros_passos/configuracao_inicial_do_git.html">
                                <i class="fa fa-check"></i> <b>1.5)</b> Configuração Inicial do Git
                            </a>
                            
                        </li>
                    
                        <li  data-level="1.6" data-path="primeiros_passos/obtendo_ajuda.html">
                            
                            <a href="../primeiros_passos/obtendo_ajuda.html">
                                <i class="fa fa-check"></i> <b>1.6)</b> Obtendo Ajuda
                            </a>
                            
                        </li>
                    
                        <li  data-level="1.7" data-path="primeiros_passos/resumo.html">
                            
                            <a href="../primeiros_passos/resumo.html">
                                <i class="fa fa-check"></i> <b>1.7)</b> Resumo
                            </a>
                            
                        </li>
                    
                </ul>
                
            </li>
        
            <li  data-level="2" data-path="git_essencial/README.html">
                
                <a href="../git_essencial/README.html">
                    <i class="fa fa-check"></i> <b>2)</b> Git Essencial
                </a>
                
                
                <ul class="articles">
                    
                        <li  data-level="2.1" data-path="git_essencial/obtendo_um_repositorio_git.html">
                            
                            <a href="../git_essencial/obtendo_um_repositorio_git.html">
                                <i class="fa fa-check"></i> <b>2.1)</b> Obtendo um Repositório Git
                            </a>
                            
                        </li>
                    
                        <li  data-level="2.2" data-path="git_essencial/gravando_alteracoes_no_repositorio.html">
                            
                            <a href="../git_essencial/gravando_alteracoes_no_repositorio.html">
                                <i class="fa fa-check"></i> <b>2.2)</b> Gravando Alterações no Repositório
                            </a>
                            
                        </li>
                    
                        <li  data-level="2.3" data-path="git_essencial/visualizando_o_historico_de_commits.html">
                            
                            <a href="../git_essencial/visualizando_o_historico_de_commits.html">
                                <i class="fa fa-check"></i> <b>2.3)</b> Visualizando o Histórico de Commits
                            </a>
                            
                        </li>
                    
                        <li  data-level="2.4" data-path="git_essencial/desfazendo_coisas.html">
                            
                            <a href="../git_essencial/desfazendo_coisas.html">
                                <i class="fa fa-check"></i> <b>2.4)</b> Desfazendo Coisas
                            </a>
                            
                        </li>
                    
                        <li  data-level="2.5" data-path="git_essencial/trabalhando_com_remotos.html">
                            
                            <a href="../git_essencial/trabalhando_com_remotos.html">
                                <i class="fa fa-check"></i> <b>2.5)</b> Trabalhando com Remotos
                            </a>
                            
                        </li>
                    
                        <li  data-level="2.6" data-path="git_essencial/tagging.html">
                            
                            <a href="../git_essencial/tagging.html">
                                <i class="fa fa-check"></i> <b>2.6)</b> Tagging
                            </a>
                            
                        </li>
                    
                        <li  data-level="2.7" data-path="git_essencial/dicas_e_truques.html">
                            
                            <a href="../git_essencial/dicas_e_truques.html">
                                <i class="fa fa-check"></i> <b>2.7)</b> Dicas e Truques
                            </a>
                            
                        </li>
                    
                        <li  data-level="2.8" data-path="git_essencial/sumario.html">
                            
                            <a href="../git_essencial/sumario.html">
                                <i class="fa fa-check"></i> <b>2.8)</b> Sumário
                            </a>
                            
                        </li>
                    
                </ul>
                
            </li>
        
            <li  data-level="3" data-path="ramificacao_branching_no_git/README.html">
                
                <a href="../ramificacao_branching_no_git/README.html">
                    <i class="fa fa-check"></i> <b>3)</b> Ramificação (Branching) no Git
                </a>
                
                
                <ul class="articles">
                    
                        <li  data-level="3.1" data-path="ramificacao_branching_no_git/o_que_e_um_branch.html">
                            
                            <a href="../ramificacao_branching_no_git/o_que_e_um_branch.html">
                                <i class="fa fa-check"></i> <b>3.1)</b> O que é um Branch
                            </a>
                            
                        </li>
                    
                        <li  data-level="3.2" data-path="ramificacao_branching_no_git/basico_de_branch_e_merge.html">
                            
                            <a href="../ramificacao_branching_no_git/basico_de_branch_e_merge.html">
                                <i class="fa fa-check"></i> <b>3.2)</b> Básico de Branch e Merge
                            </a>
                            
                        </li>
                    
                        <li  data-level="3.3" data-path="ramificacao_branching_no_git/gerenciamento_de_branches.html">
                            
                            <a href="../ramificacao_branching_no_git/gerenciamento_de_branches.html">
                                <i class="fa fa-check"></i> <b>3.3)</b> Gerenciamento de Branches
                            </a>
                            
                        </li>
                    
                        <li  data-level="3.4" data-path="ramificacao_branching_no_git/fluxos_de_trabalho_com_branches.html">
                            
                            <a href="../ramificacao_branching_no_git/fluxos_de_trabalho_com_branches.html">
                                <i class="fa fa-check"></i> <b>3.4)</b> Fluxos de Trabalho com Branches
                            </a>
                            
                        </li>
                    
                        <li  data-level="3.5" data-path="ramificacao_branching_no_git/branches_remotos.html">
                            
                            <a href="../ramificacao_branching_no_git/branches_remotos.html">
                                <i class="fa fa-check"></i> <b>3.5)</b> Branches Remotos
                            </a>
                            
                        </li>
                    
                        <li  data-level="3.6" data-path="ramificacao_branching_no_git/rebasing.html">
                            
                            <a href="../ramificacao_branching_no_git/rebasing.html">
                                <i class="fa fa-check"></i> <b>3.6)</b> Rebasing
                            </a>
                            
                        </li>
                    
                        <li  data-level="3.7" data-path="ramificacao_branching_no_git/sumario.html">
                            
                            <a href="../ramificacao_branching_no_git/sumario.html">
                                <i class="fa fa-check"></i> <b>3.7)</b> Sumário
                            </a>
                            
                        </li>
                    
                </ul>
                
            </li>
        
            <li  data-level="4" data-path="git_no_servidor/README.html">
                
                <a href="../git_no_servidor/README.html">
                    <i class="fa fa-check"></i> <b>4)</b> Git no Servidor
                </a>
                
                
                <ul class="articles">
                    
                        <li  data-level="4.1" data-path="git_no_servidor/os_protocolos.html">
                            
                            <a href="../git_no_servidor/os_protocolos.html">
                                <i class="fa fa-check"></i> <b>4.1)</b> Os Protocolos
                            </a>
                            
                        </li>
                    
                        <li  data-level="4.2" data-path="git_no_servidor/configurando_git_no_servidor.html">
                            
                            <a href="../git_no_servidor/configurando_git_no_servidor.html">
                                <i class="fa fa-check"></i> <b>4.2)</b> Configurando Git no Servidor
                            </a>
                            
                        </li>
                    
                        <li  data-level="4.3" data-path="git_no_servidor/gerando_sua_chave_publica_ssh.html">
                            
                            <a href="../git_no_servidor/gerando_sua_chave_publica_ssh.html">
                                <i class="fa fa-check"></i> <b>4.3)</b> Gerando Sua Chave Pública SSH
                            </a>
                            
                        </li>
                    
                        <li  data-level="4.4" data-path="git_no_servidor/configurando_o_servidor.html">
                            
                            <a href="../git_no_servidor/configurando_o_servidor.html">
                                <i class="fa fa-check"></i> <b>4.4)</b> Configurando o Servidor
                            </a>
                            
                        </li>
                    
                        <li  data-level="4.5" data-path="git_no_servidor/acesso_publico.html">
                            
                            <a href="../git_no_servidor/acesso_publico.html">
                                <i class="fa fa-check"></i> <b>4.5)</b> Acesso Público
                            </a>
                            
                        </li>
                    
                        <li  data-level="4.6" data-path="git_no_servidor/gitweb.html">
                            
                            <a href="../git_no_servidor/gitweb.html">
                                <i class="fa fa-check"></i> <b>4.6)</b> GitWeb
                            </a>
                            
                        </li>
                    
                        <li  data-level="4.7" data-path="git_no_servidor/gitosis.html">
                            
                            <a href="../git_no_servidor/gitosis.html">
                                <i class="fa fa-check"></i> <b>4.7)</b> Gitosis
                            </a>
                            
                        </li>
                    
                        <li  data-level="4.8" data-path="git_no_servidor/gitolite.html">
                            
                            <a href="../git_no_servidor/gitolite.html">
                                <i class="fa fa-check"></i> <b>4.8)</b> Gitolite
                            </a>
                            
                        </li>
                    
                        <li  data-level="4.9" data-path="git_no_servidor/servico_git.html">
                            
                            <a href="../git_no_servidor/servico_git.html">
                                <i class="fa fa-check"></i> <b>4.9)</b> Serviço Git
                            </a>
                            
                        </li>
                    
                        <li  data-level="4.10" data-path="git_no_servidor/git_hospedado.html">
                            
                            <a href="../git_no_servidor/git_hospedado.html">
                                <i class="fa fa-check"></i> <b>4.10)</b> Git Hospedado
                            </a>
                            
                        </li>
                    
                        <li  data-level="4.11" data-path="git_no_servidor/sumario.html">
                            
                            <a href="../git_no_servidor/sumario.html">
                                <i class="fa fa-check"></i> <b>4.11)</b> Sumário
                            </a>
                            
                        </li>
                    
                </ul>
                
            </li>
        
            <li  data-level="5" data-path="git_distribuido/README.html">
                
                <a href="../git_distribuido/README.html">
                    <i class="fa fa-check"></i> <b>5)</b> Git Distribuído
                </a>
                
                
                <ul class="articles">
                    
                        <li  data-level="5.1" data-path="git_distribuido/fluxos_de_trabalho_distribuidos.html">
                            
                            <a href="../git_distribuido/fluxos_de_trabalho_distribuidos.html">
                                <i class="fa fa-check"></i> <b>5.1)</b> Fluxos de Trabalho Distribuídos
                            </a>
                            
                        </li>
                    
                        <li  data-level="5.2" data-path="git_distribuido/contribuindo_para_um_projeto.html">
                            
                            <a href="../git_distribuido/contribuindo_para_um_projeto.html">
                                <i class="fa fa-check"></i> <b>5.2)</b> Contribuindo Para Um Projeto
                            </a>
                            
                        </li>
                    
                        <li  data-level="5.3" data-path="git_distribuido/mantendo_um_projeto.html">
                            
                            <a href="../git_distribuido/mantendo_um_projeto.html">
                                <i class="fa fa-check"></i> <b>5.3)</b> Mantendo Um Projeto
                            </a>
                            
                        </li>
                    
                        <li  data-level="5.4" data-path="git_distribuido/resumo.html">
                            
                            <a href="../git_distribuido/resumo.html">
                                <i class="fa fa-check"></i> <b>5.4)</b> Resumo
                            </a>
                            
                        </li>
                    
                </ul>
                
            </li>
        
            <li  data-level="6" data-path="ferramentas_do_git/README.html">
                
                <a href="../ferramentas_do_git/README.html">
                    <i class="fa fa-check"></i> <b>6)</b> Ferramentas do Git
                </a>
                
                
                <ul class="articles">
                    
                        <li  data-level="6.1" data-path="ferramentas_do_git/selecao_de_revisao.html">
                            
                            <a href="../ferramentas_do_git/selecao_de_revisao.html">
                                <i class="fa fa-check"></i> <b>6.1)</b> Seleção de Revisão
                            </a>
                            
                        </li>
                    
                        <li  data-level="6.2" data-path="ferramentas_do_git/area_de_selecao_interativa.html">
                            
                            <a href="../ferramentas_do_git/area_de_selecao_interativa.html">
                                <i class="fa fa-check"></i> <b>6.2)</b> Área de Seleção Interativa
                            </a>
                            
                        </li>
                    
                        <li  data-level="6.3" data-path="ferramentas_do_git/fazendo_stash.html">
                            
                            <a href="../ferramentas_do_git/fazendo_stash.html">
                                <i class="fa fa-check"></i> <b>6.3)</b> Fazendo Stash
                            </a>
                            
                        </li>
                    
                        <li  data-level="6.4" data-path="ferramentas_do_git/reescrevendo_o_historico.html">
                            
                            <a href="../ferramentas_do_git/reescrevendo_o_historico.html">
                                <i class="fa fa-check"></i> <b>6.4)</b> Reescrevendo o Histórico
                            </a>
                            
                        </li>
                    
                        <li  data-level="6.5" data-path="ferramentas_do_git/depurando_com_git.html">
                            
                            <a href="../ferramentas_do_git/depurando_com_git.html">
                                <i class="fa fa-check"></i> <b>6.5)</b> Depurando com Git
                            </a>
                            
                        </li>
                    
                        <li  data-level="6.6" data-path="ferramentas_do_git/submodulos.html">
                            
                            <a href="../ferramentas_do_git/submodulos.html">
                                <i class="fa fa-check"></i> <b>6.6)</b> Submódulos
                            </a>
                            
                        </li>
                    
                        <li  data-level="6.7" data-path="ferramentas_do_git/merge_de_sub_arvore_subtree_merging.html">
                            
                            <a href="../ferramentas_do_git/merge_de_sub_arvore_subtree_merging.html">
                                <i class="fa fa-check"></i> <b>6.7)</b> Merge de Sub-árvore (Subtree Merging)
                            </a>
                            
                        </li>
                    
                        <li  data-level="6.8" data-path="ferramentas_do_git/sumario.html">
                            
                            <a href="../ferramentas_do_git/sumario.html">
                                <i class="fa fa-check"></i> <b>6.8)</b> Sumário
                            </a>
                            
                        </li>
                    
                </ul>
                
            </li>
        
            <li  data-level="7" data-path="customizando_o_git/README.html">
                
                <a href="../customizando_o_git/README.html">
                    <i class="fa fa-check"></i> <b>7)</b> Customizando o Git
                </a>
                
                
                <ul class="articles">
                    
                        <li  data-level="7.1" data-path="customizando_o_git/configuracao_do_git.html">
                            
                            <a href="../customizando_o_git/configuracao_do_git.html">
                                <i class="fa fa-check"></i> <b>7.1)</b> Configuração do Git
                            </a>
                            
                        </li>
                    
                        <li  data-level="7.2" data-path="customizando_o_git/atributos_git.html">
                            
                            <a href="../customizando_o_git/atributos_git.html">
                                <i class="fa fa-check"></i> <b>7.2)</b> Atributos Git
                            </a>
                            
                        </li>
                    
                        <li  data-level="7.3" data-path="customizando_o_git/hooks_do_git.html">
                            
                            <a href="../customizando_o_git/hooks_do_git.html">
                                <i class="fa fa-check"></i> <b>7.3)</b> Hooks do Git
                            </a>
                            
                        </li>
                    
                        <li  data-level="7.4" data-path="customizando_o_git/um_exemplo_de_politica_git_forcada.html">
                            
                            <a href="../customizando_o_git/um_exemplo_de_politica_git_forcada.html">
                                <i class="fa fa-check"></i> <b>7.4)</b> Um exemplo de Política Git Forçada
                            </a>
                            
                        </li>
                    
                        <li  data-level="7.5" data-path="customizando_o_git/sumario.html">
                            
                            <a href="../customizando_o_git/sumario.html">
                                <i class="fa fa-check"></i> <b>7.5)</b> Sumário
                            </a>
                            
                        </li>
                    
                </ul>
                
            </li>
        
            <li  data-level="8" data-path="git_e_outros_sistemas/README.html">
                
                <a href="../git_e_outros_sistemas/README.html">
                    <i class="fa fa-check"></i> <b>8)</b> Git e Outros Sistemas
                </a>
                
                
                <ul class="articles">
                    
                        <li  data-level="8.1" data-path="git_e_outros_sistemas/git_e_subversion.html">
                            
                            <a href="../git_e_outros_sistemas/git_e_subversion.html">
                                <i class="fa fa-check"></i> <b>8.1)</b> Git e Subversion
                            </a>
                            
                        </li>
                    
                        <li  data-level="8.2" data-path="git_e_outros_sistemas/migrando_para_o_git.html">
                            
                            <a href="../git_e_outros_sistemas/migrando_para_o_git.html">
                                <i class="fa fa-check"></i> <b>8.2)</b> Migrando para o Git
                            </a>
                            
                        </li>
                    
                        <li  data-level="8.3" data-path="git_e_outros_sistemas/resumo.html">
                            
                            <a href="../git_e_outros_sistemas/resumo.html">
                                <i class="fa fa-check"></i> <b>8.3)</b> Resumo
                            </a>
                            
                        </li>
                    
                </ul>
                
            </li>
        
            <li  data-level="9" data-path="git_internamente/README.html">
                
                <a href="../git_internamente/README.html">
                    <i class="fa fa-check"></i> <b>9)</b> Git Internamente
                </a>
                
                
                <ul class="articles">
                    
                        <li  data-level="9.1" data-path="git_internamente/encanamento_plumbing_e_porcelana_porcelain.html">
                            
                            <a href="../git_internamente/encanamento_plumbing_e_porcelana_porcelain.html">
                                <i class="fa fa-check"></i> <b>9.1)</b> Encanamento (Plumbing) e Porcelana (Porcelain)
                            </a>
                            
                        </li>
                    
                        <li  data-level="9.2" data-path="git_internamente/objetos_do_git.html">
                            
                            <a href="../git_internamente/objetos_do_git.html">
                                <i class="fa fa-check"></i> <b>9.2)</b> Objetos do Git
                            </a>
                            
                        </li>
                    
                        <li  data-level="9.3" data-path="git_internamente/referencias_git.html">
                            
                            <a href="../git_internamente/referencias_git.html">
                                <i class="fa fa-check"></i> <b>9.3)</b> Referencias Git
                            </a>
                            
                        </li>
                    
                        <li  data-level="9.4" data-path="git_internamente/packfiles.html">
                            
                            <a href="../git_internamente/packfiles.html">
                                <i class="fa fa-check"></i> <b>9.4)</b> Packfiles
                            </a>
                            
                        </li>
                    
                        <li  data-level="9.5" data-path="git_internamente/o_refspec.html">
                            
                            <a href="../git_internamente/o_refspec.html">
                                <i class="fa fa-check"></i> <b>9.5)</b> O Refspec
                            </a>
                            
                        </li>
                    
                        <li  data-level="9.6" data-path="git_internamente/protocolos_de_transferencia.html">
                            
                            <a href="../git_internamente/protocolos_de_transferencia.html">
                                <i class="fa fa-check"></i> <b>9.6)</b> Protocolos de Transferência
                            </a>
                            
                        </li>
                    
                        <li  data-level="9.7" data-path="git_internamente/manutencao_e_recuperacao_de_dados.html">
                            
                            <a href="../git_internamente/manutencao_e_recuperacao_de_dados.html">
                                <i class="fa fa-check"></i> <b>9.7)</b> Manutenção e Recuperação de Dados
                            </a>
                            
                        </li>
                    
                        <li  data-level="9.8" data-path="git_internamente/resumo.html">
                            
                            <a href="../git_internamente/resumo.html">
                                <i class="fa fa-check"></i> <b>9.8)</b> Resumo
                            </a>
                            
                        </li>
                    
                </ul>
                
            </li>
        
    </ul>
</div>

    <div class="book-body" tabindex="-1">
        <div class="body-inner">
            <div class="page-wrapper">
                <div class="book-progress">
    <div class="bar">
        <div class="inner" style="width: 80%;min-width: 78.57142857142857%;"></div>
    </div>
    <div class="chapters">
    
        <a href="../index.html" title="Introduction" class="chapter done new-chapter" data-progress="0" style="left: 0%;"></a>
    
        <a href="../primeiros_passos/README.html" title="Primeiros passos" class="chapter done new-chapter" data-progress="1" style="left: 1.4285714285714286%;"></a>
    
        <a href="../primeiros_passos/sobre_controle_de_versao.html" title="Sobre Controle de Versão" class="chapter done " data-progress="1.1" style="left: 2.857142857142857%;"></a>
    
        <a href="../primeiros_passos/uma_breve_historia_do_git.html" title="Uma Breve História do Git" class="chapter done " data-progress="1.2" style="left: 4.285714285714286%;"></a>
    
        <a href="../primeiros_passos/nocoes_basicas_de_git.html" title="Noções Básicas de Git" class="chapter done " data-progress="1.3" style="left: 5.714285714285714%;"></a>
    
        <a href="../primeiros_passos/instalando_git.html" title="Instalando Git" class="chapter done " data-progress="1.4" style="left: 7.142857142857143%;"></a>
    
        <a href="../primeiros_passos/configuracao_inicial_do_git.html" title="Configuração Inicial do Git" class="chapter done " data-progress="1.5" style="left: 8.571428571428571%;"></a>
    
        <a href="../primeiros_passos/obtendo_ajuda.html" title="Obtendo Ajuda" class="chapter done " data-progress="1.6" style="left: 10%;"></a>
    
        <a href="../primeiros_passos/resumo.html" title="Resumo" class="chapter done " data-progress="1.7" style="left: 11.428571428571429%;"></a>
    
        <a href="../git_essencial/README.html" title="Git Essencial" class="chapter done new-chapter" data-progress="2" style="left: 12.857142857142858%;"></a>
    
        <a href="../git_essencial/obtendo_um_repositorio_git.html" title="Obtendo um Repositório Git" class="chapter done " data-progress="2.1" style="left: 14.285714285714286%;"></a>
    
        <a href="../git_essencial/gravando_alteracoes_no_repositorio.html" title="Gravando Alterações no Repositório" class="chapter done " data-progress="2.2" style="left: 15.714285714285714%;"></a>
    
        <a href="../git_essencial/visualizando_o_historico_de_commits.html" title="Visualizando o Histórico de Commits" class="chapter done " data-progress="2.3" style="left: 17.142857142857142%;"></a>
    
        <a href="../git_essencial/desfazendo_coisas.html" title="Desfazendo Coisas" class="chapter done " data-progress="2.4" style="left: 18.571428571428573%;"></a>
    
        <a href="../git_essencial/trabalhando_com_remotos.html" title="Trabalhando com Remotos" class="chapter done " data-progress="2.5" style="left: 20%;"></a>
    
        <a href="../git_essencial/tagging.html" title="Tagging" class="chapter done " data-progress="2.6" style="left: 21.428571428571427%;"></a>
    
        <a href="../git_essencial/dicas_e_truques.html" title="Dicas e Truques" class="chapter done " data-progress="2.7" style="left: 22.857142857142858%;"></a>
    
        <a href="../git_essencial/sumario.html" title="Sumário" class="chapter done " data-progress="2.8" style="left: 24.285714285714285%;"></a>
    
        <a href="../ramificacao_branching_no_git/README.html" title="Ramificação (Branching) no Git" class="chapter done new-chapter" data-progress="3" style="left: 25.714285714285715%;"></a>
    
        <a href="../ramificacao_branching_no_git/o_que_e_um_branch.html" title="O que é um Branch" class="chapter done " data-progress="3.1" style="left: 27.142857142857142%;"></a>
    
        <a href="../ramificacao_branching_no_git/basico_de_branch_e_merge.html" title="Básico de Branch e Merge" class="chapter done " data-progress="3.2" style="left: 28.571428571428573%;"></a>
    
        <a href="../ramificacao_branching_no_git/gerenciamento_de_branches.html" title="Gerenciamento de Branches" class="chapter done " data-progress="3.3" style="left: 30%;"></a>
    
        <a href="../ramificacao_branching_no_git/fluxos_de_trabalho_com_branches.html" title="Fluxos de Trabalho com Branches" class="chapter done " data-progress="3.4" style="left: 31.428571428571427%;"></a>
    
        <a href="../ramificacao_branching_no_git/branches_remotos.html" title="Branches Remotos" class="chapter done " data-progress="3.5" style="left: 32.857142857142854%;"></a>
    
        <a href="../ramificacao_branching_no_git/rebasing.html" title="Rebasing" class="chapter done " data-progress="3.6" style="left: 34.285714285714285%;"></a>
    
        <a href="../ramificacao_branching_no_git/sumario.html" title="Sumário" class="chapter done " data-progress="3.7" style="left: 35.714285714285715%;"></a>
    
        <a href="../git_no_servidor/README.html" title="Git no Servidor" class="chapter done new-chapter" data-progress="4" style="left: 37.142857142857146%;"></a>
    
        <a href="../git_no_servidor/os_protocolos.html" title="Os Protocolos" class="chapter done " data-progress="4.1" style="left: 38.57142857142857%;"></a>
    
        <a href="../git_no_servidor/git_hospedado.html" title="Git Hospedado" class="chapter done " data-progress="4.10" style="left: 40%;"></a>
    
        <a href="../git_no_servidor/sumario.html" title="Sumário" class="chapter done " data-progress="4.11" style="left: 41.42857142857143%;"></a>
    
        <a href="../git_no_servidor/configurando_git_no_servidor.html" title="Configurando Git no Servidor" class="chapter done " data-progress="4.2" style="left: 42.857142857142854%;"></a>
    
        <a href="../git_no_servidor/gerando_sua_chave_publica_ssh.html" title="Gerando Sua Chave Pública SSH" class="chapter done " data-progress="4.3" style="left: 44.285714285714285%;"></a>
    
        <a href="../git_no_servidor/configurando_o_servidor.html" title="Configurando o Servidor" class="chapter done " data-progress="4.4" style="left: 45.714285714285715%;"></a>
    
        <a href="../git_no_servidor/acesso_publico.html" title="Acesso Público" class="chapter done " data-progress="4.5" style="left: 47.142857142857146%;"></a>
    
        <a href="../git_no_servidor/gitweb.html" title="GitWeb" class="chapter done " data-progress="4.6" style="left: 48.57142857142857%;"></a>
    
        <a href="../git_no_servidor/gitosis.html" title="Gitosis" class="chapter done " data-progress="4.7" style="left: 50%;"></a>
    
        <a href="../git_no_servidor/gitolite.html" title="Gitolite" class="chapter done " data-progress="4.8" style="left: 51.42857142857143%;"></a>
    
        <a href="../git_no_servidor/servico_git.html" title="Serviço Git" class="chapter done " data-progress="4.9" style="left: 52.857142857142854%;"></a>
    
        <a href="../git_distribuido/README.html" title="Git Distribuído" class="chapter done new-chapter" data-progress="5" style="left: 54.285714285714285%;"></a>
    
        <a href="../git_distribuido/fluxos_de_trabalho_distribuidos.html" title="Fluxos de Trabalho Distribuídos" class="chapter done " data-progress="5.1" style="left: 55.714285714285715%;"></a>
    
        <a href="../git_distribuido/contribuindo_para_um_projeto.html" title="Contribuindo Para Um Projeto" class="chapter done " data-progress="5.2" style="left: 57.142857142857146%;"></a>
    
        <a href="../git_distribuido/mantendo_um_projeto.html" title="Mantendo Um Projeto" class="chapter done " data-progress="5.3" style="left: 58.57142857142857%;"></a>
    
        <a href="../git_distribuido/resumo.html" title="Resumo" class="chapter done " data-progress="5.4" style="left: 60%;"></a>
    
        <a href="../ferramentas_do_git/README.html" title="Ferramentas do Git" class="chapter done new-chapter" data-progress="6" style="left: 61.42857142857143%;"></a>
    
        <a href="../ferramentas_do_git/selecao_de_revisao.html" title="Seleção de Revisão" class="chapter done " data-progress="6.1" style="left: 62.857142857142854%;"></a>
    
        <a href="../ferramentas_do_git/area_de_selecao_interativa.html" title="Área de Seleção Interativa" class="chapter done " data-progress="6.2" style="left: 64.28571428571429%;"></a>
    
        <a href="../ferramentas_do_git/fazendo_stash.html" title="Fazendo Stash" class="chapter done " data-progress="6.3" style="left: 65.71428571428571%;"></a>
    
        <a href="../ferramentas_do_git/reescrevendo_o_historico.html" title="Reescrevendo o Histórico" class="chapter done " data-progress="6.4" style="left: 67.14285714285714%;"></a>
    
        <a href="../ferramentas_do_git/depurando_com_git.html" title="Depurando com Git" class="chapter done " data-progress="6.5" style="left: 68.57142857142857%;"></a>
    
        <a href="../ferramentas_do_git/submodulos.html" title="Submódulos" class="chapter done " data-progress="6.6" style="left: 70%;"></a>
    
        <a href="../ferramentas_do_git/merge_de_sub_arvore_subtree_merging.html" title="Merge de Sub-árvore (Subtree Merging)" class="chapter done " data-progress="6.7" style="left: 71.42857142857143%;"></a>
    
        <a href="../ferramentas_do_git/sumario.html" title="Sumário" class="chapter done " data-progress="6.8" style="left: 72.85714285714286%;"></a>
    
        <a href="../customizando_o_git/README.html" title="Customizando o Git" class="chapter done new-chapter" data-progress="7" style="left: 74.28571428571429%;"></a>
    
        <a href="../customizando_o_git/configuracao_do_git.html" title="Configuração do Git" class="chapter done " data-progress="7.1" style="left: 75.71428571428571%;"></a>
    
        <a href="../customizando_o_git/atributos_git.html" title="Atributos Git" class="chapter done " data-progress="7.2" style="left: 77.14285714285714%;"></a>
    
        <a href="../customizando_o_git/hooks_do_git.html" title="Hooks do Git" class="chapter done " data-progress="7.3" style="left: 78.57142857142857%;"></a>
    
        <a href="../customizando_o_git/um_exemplo_de_politica_git_forcada.html" title="Um exemplo de Política Git Forçada" class="chapter done " data-progress="7.4" style="left: 80%;"></a>
    
        <a href="../customizando_o_git/sumario.html" title="Sumário" class="chapter  " data-progress="7.5" style="left: 81.42857142857143%;"></a>
    
        <a href="../git_e_outros_sistemas/README.html" title="Git e Outros Sistemas" class="chapter  new-chapter" data-progress="8" style="left: 82.85714285714286%;"></a>
    
        <a href="../git_e_outros_sistemas/git_e_subversion.html" title="Git e Subversion" class="chapter  " data-progress="8.1" style="left: 84.28571428571429%;"></a>
    
        <a href="../git_e_outros_sistemas/migrando_para_o_git.html" title="Migrando para o Git" class="chapter  " data-progress="8.2" style="left: 85.71428571428571%;"></a>
    
        <a href="../git_e_outros_sistemas/resumo.html" title="Resumo" class="chapter  " data-progress="8.3" style="left: 87.14285714285714%;"></a>
    
        <a href="../git_internamente/README.html" title="Git Internamente" class="chapter  new-chapter" data-progress="9" style="left: 88.57142857142857%;"></a>
    
        <a href="../git_internamente/encanamento_plumbing_e_porcelana_porcelain.html" title="Encanamento (Plumbing) e Porcelana (Porcelain)" class="chapter  " data-progress="9.1" style="left: 90%;"></a>
    
        <a href="../git_internamente/objetos_do_git.html" title="Objetos do Git" class="chapter  " data-progress="9.2" style="left: 91.42857142857143%;"></a>
    
        <a href="../git_internamente/referencias_git.html" title="Referencias Git" class="chapter  " data-progress="9.3" style="left: 92.85714285714286%;"></a>
    
        <a href="../git_internamente/packfiles.html" title="Packfiles" class="chapter  " data-progress="9.4" style="left: 94.28571428571429%;"></a>
    
        <a href="../git_internamente/o_refspec.html" title="O Refspec" class="chapter  " data-progress="9.5" style="left: 95.71428571428571%;"></a>
    
        <a href="../git_internamente/protocolos_de_transferencia.html" title="Protocolos de Transferência" class="chapter  " data-progress="9.6" style="left: 97.14285714285714%;"></a>
    
        <a href="../git_internamente/manutencao_e_recuperacao_de_dados.html" title="Manutenção e Recuperação de Dados" class="chapter  " data-progress="9.7" style="left: 98.57142857142857%;"></a>
    
        <a href="../git_internamente/resumo.html" title="Resumo" class="chapter  " data-progress="9.8" style="left: 100%;"></a>
    
    </div>
</div>

                <div class="page-inner">
                
                    <section class="normal" id="section-gitbook_824">
                    
                        <h1 id="um-exemplo-de-pol-tica-git-for-ada">Um exemplo de Política Git Forçada</h1>
<p>Nesta seção, você vai usar o que aprendeu para estabelecer um fluxo de trabalho Git que verifica um formato de mensagem personalizado para commit, e força o uso apenas de push fast-forward, e permite que apenas alguns usuários possam modificar determinados subdiretórios em um projeto. Você vai construir scripts cliente que ajudam ao desenvolvedor saber se seu push será rejeitado e scripts de servidor que fazem valer as políticas.</p>
<p>Eu usei Ruby para escrever estes, isso porque é a minha linguagem de script preferida e porque eu sinto que é a linguagem de script que mais parece com pseudocódigo; assim você deve ser capaz de seguir o código, mesmo que você não use Ruby. No entanto, qualquer linguagem funcionará bem. Todos os exemplos de scripts de hooks distribuídos com o Git são feitos em Perl ou Bash, então você também pode ver vários exemplos de hooks nessas linguagens olhando os exemplos.</p>
<h2 id="hook-do-lado-servidor">Hook do Lado Servidor</h2>
<p>Todo o trabalho do lado servidor irá para o arquivo update no seu diretório de hooks. O arquivo update é executado uma vez por branch de cada push e leva a referência do push para a revisão antiga onde o branch estava, e a nova revisão do push. Você também terá acesso ao usuário que está realizando o push, se o push está sendo executado através de SSH. Se você permitiu que todos se conectem com um único usuário (como &quot;git&quot;), através de autenticação de chave pública, você pode ter que dar ao usuário um &quot;shell wrapper&quot; que determina qual usuário está se conectando com base na chave pública, e definir uma variável de ambiente especificando o usuário. Aqui eu assumo que o usuário de conexão está na variável de ambiente <code>$USER</code>, então, seu script de atualização começa reunindo todas as informações que você precisa:</p>
<pre><code><span class="hljs-comment">#!/usr/bin/env ruby</span>

<span class="hljs-variable">$refname</span> = <span class="hljs-constant">ARGV</span>[<span class="hljs-number">0</span>]
<span class="hljs-variable">$oldrev</span>  = <span class="hljs-constant">ARGV</span>[<span class="hljs-number">1</span>]
<span class="hljs-variable">$newrev</span>  = <span class="hljs-constant">ARGV</span>[<span class="hljs-number">2</span>]
<span class="hljs-variable">$user</span>    = <span class="hljs-constant">ENV</span>[<span class="hljs-string">'USER'</span>]

puts <span class="hljs-string">"Enforcing Policies... \n(<span class="hljs-subst">#{<span class="hljs-variable">$refname</span>}</span>) (<span class="hljs-subst">#{<span class="hljs-variable">$oldrev</span>[<span class="hljs-number">0</span>,<span class="hljs-number">6</span>]}</span>) (<span class="hljs-subst">#{<span class="hljs-variable">$newrev</span>[<span class="hljs-number">0</span>,<span class="hljs-number">6</span>]}</span>)"</span>
</code></pre><p>Sim, eu estou usando variáveis ​​globais. Não me julgue — é mais fácil para demonstrar desta maneira.</p>
<h3 id="impondo-um-formato-espec-fico-de-mensagens-de-commit">Impondo um Formato Específico de Mensagens de Commit</h3>
<p>Seu primeiro desafio é impor que cada mensagem de commit deve aderir a um formato específico. Só para se ter uma meta, vamos supor que cada mensagem tem de incluir uma string que parece com &quot;ref: 1234&quot; porque você quer que cada commit tenha um link para um item de trabalho no seu sistema de chamados. Você deve olhar para cada commit do push, ver se essa sequência está na mensagem de commit, e, se a string estiver ausente de qualquer um dos commits, retornar zero para que o push seja rejeitado.</p>
<p>Você pode obter uma lista dos valores SHA-1 de todos os commits de um push, através dos valores <code>$newrev</code> e <code>$oldrev</code> e passando-os para um comando Git plumbing chamado <code>git rev-list</code>. Este é basicamente o comando <code>git log</code>, mas por padrão ele mostra apenas os valores SHA-1 e nenhuma outra informação. Assim, para obter uma lista de todos os SHAs de commits introduzidos entre um commit SHA e outro, você pode executar algo como abaixo:</p>
<pre><code>$ git rev-<span class="hljs-built_in">list</span> <span class="hljs-number">538</span>c33..d14fc7
d14fc7c847ab946ec39590d87783c69b031bdfb7
<span class="hljs-number">9f</span>585da4401b0a3999e84113824d15245c13f0be
<span class="hljs-number">234071</span>a1be950e2a8d078e6141f5cd20c1e61ad3
dfa04c9ef3d5197182f13fb5b9b1fb7717d2222a
<span class="hljs-number">17716</span>ec0f1ff5c77eff40b7fe912f9f6cfd0e475
</code></pre><p>Você pode pegar essa saída, percorrer cada um dos SHAs dos commits, pegar a mensagem para ele, e testar a mensagem contra uma expressão regular que procura um padrão.</p>
<p>Você tem que descobrir como pegar a mensagem de confirmação de cada um dos commits para testar. Para obter os dados brutos do commit, você pode usar um outro comando plumbing chamado <code>git cat-file</code>. Eu vou falar de todos estes comandos plumbing em detalhes no Capítulo 9; mas, por agora, aqui está o resultado do comando:</p>
<pre><code>$ git cat-<span class="hljs-keyword">file</span> commit ca82a6
tree cfda3bf379e4f8dba8717dee55aab78aef7f4daf
<span class="hljs-keyword">parent</span> <span class="hljs-number">085</span>bb3bcb608e1e8451d4b2432f8ecbe6306e7e7
author Scott Chacon &lt;schacon<span class="hljs-variable">@gmail</span>.com&gt; <span class="hljs-number">1205815931</span> -<span class="hljs-number">0700</span>
committer Scott Chacon &lt;schacon<span class="hljs-variable">@gmail</span>.com&gt; <span class="hljs-number">1240030591</span> -<span class="hljs-number">0700</span>

changed the verison number
</code></pre><p>Uma maneira simples de obter a mensagem de confirmação de um commit quando você tem o valor SHA-1 é ir para a primeira linha em branco e retirar tudo depois dela. Você pode fazer isso com o comando <code>sed</code> em sistemas Unix:</p>
<pre><code>$ git cat-<span class="hljs-built_in">file</span> commit ca82a6 | sed <span class="hljs-string">'1,/^$/d'</span>
changed <span class="hljs-operator">the</span> verison <span class="hljs-built_in">number</span>
</code></pre><p>Você pode usar isso para pegar a mensagem de cada commit do push e sair se você ver algo que não corresponde. Para sair do script e rejeitar o push, retorne um valor diferente de zero. Todo o método se parece com este:</p>
<pre><code>$regex = /\[ref: (\d+)\]/

<span class="hljs-comment"># enforced custom commit message format</span>
def check_message_format
  missed_revs = `git rev-list <span class="hljs-comment">#{$oldrev}..#{$newrev}`.split("\n")</span>
  missed_revs.<span class="hljs-keyword">each</span> <span class="hljs-built_in">do</span> |rev|
    message = `git cat-<span class="hljs-built_in">file</span> commit <span class="hljs-comment">#{rev} | sed '1,/^$/d'`</span>
    <span class="hljs-keyword">if</span> !$regex.match(message)
      puts <span class="hljs-string">"[POLICY] Your message is not formatted correctly"</span>
      exit <span class="hljs-number">1</span>
    <span class="hljs-function"><span class="hljs-keyword">end</span></span>
  <span class="hljs-function"><span class="hljs-keyword">end</span></span>
<span class="hljs-function"><span class="hljs-keyword">end</span></span>
check_message_format
</code></pre><p>Colocar isso no seu script <code>update</code> rejeitará atualizações que contenham commits que tem mensagens que não aderem à sua regra.</p>
<h3 id="impondo-um-sistema-acl-baseado-em-usu-rio">Impondo um Sistema ACL Baseado em Usuário</h3>
<p>Suponha que você queira adicionar um mecanismo que utiliza uma lista de controle de acesso (ACL) que especifica quais usuários têm permissão para fazer push com mudanças para partes de seus projetos. Algumas pessoas têm acesso total, e outras só têm acesso a alterar determinados subdiretórios ou arquivos específicos. Para impor isso, você vai escrever essas regras em um arquivo chamado <code>acl</code> que ficará em seu repositório Git no servidor. O hook <code>update</code> verificará essas regras, verá quais arquivos estão sendo introduzidos nos commits do push, e determinará se o usuário que está fazendo o push tem acesso para atualizar todos os arquivos.</p>
<p>A primeira coisa que você deve fazer é escrever o seu ACL. Aqui você vai usar um formato muito parecido com o mecanismo de ACL CVS: ele usa uma série de linhas, onde o primeiro campo é <code>avail</code> ou <code>unavail</code>, o próximo campo é uma lista delimitada por vírgula dos usuários para que a regra se aplica, e o último campo é o caminho para o qual a regra se aplica (branco significando acesso em  aberto). Todos esses campos são delimitados por um caractere pipe (<code>|</code>).</p>
<p>Neste caso, você tem alguns administradores, alguns escritores de documentação com acesso ao diretório <code>doc</code>, e um desenvolvedor que só tem acesso aos diretórios <code>lib</code> e <code>tests</code>, seu arquivo ACL fica assim:</p>
<pre><code>avail|nickh,pjhyett,defunkt,tpw
avail|usinclair,cdickens,ebronte|doc
avail<span class="hljs-localvars">|schacon|lib
avail|schacon|tests</span>
</code></pre><p>Você começa lendo esses dados em uma estrutura que você pode usar. Neste caso, para manter o exemplo simples, você só vai cumprir as diretrizes do <code>avail</code>. Aqui está um método que lhe dá um array associativo onde a chave é o nome do usuário e o valor é um conjunto de paths que o usuário tem acesso de escrita:</p>
<pre><code>def get_acl_access_data(acl_file)
  <span class="hljs-comment"># read in ACL data</span>
  acl_file = File.<span class="hljs-built_in">read</span>(acl_file).<span class="hljs-built_in">split</span>(<span class="hljs-string">"\n"</span>).reject { |<span class="hljs-built_in">line</span>| <span class="hljs-built_in">line</span> == <span class="hljs-string">''</span> }
  access = {}
  acl_file.<span class="hljs-keyword">each</span> <span class="hljs-built_in">do</span> |<span class="hljs-built_in">line</span>|
    avail, users, path = <span class="hljs-built_in">line</span>.<span class="hljs-built_in">split</span>(<span class="hljs-string">'|'</span>)
    next unless avail == <span class="hljs-string">'avail'</span>
    users.<span class="hljs-built_in">split</span>(<span class="hljs-string">','</span>).<span class="hljs-keyword">each</span> <span class="hljs-built_in">do</span> |user|
      access[user] ||= []
      access[user] &lt;&lt; path
    <span class="hljs-function"><span class="hljs-keyword">end</span></span>
  <span class="hljs-function"><span class="hljs-keyword">end</span></span>
  access
<span class="hljs-function"><span class="hljs-keyword">end</span></span>
</code></pre><p>No arquivo ACL que você viu anteriormente, o método <code>get_acl_access_data</code> retorna uma estrutura de dados que se parece com esta:</p>
<pre><code>{<span class="hljs-string">"defunkt"</span>=&gt;[nil],
 <span class="hljs-string">"tpw"</span>=&gt;[nil],
 <span class="hljs-string">"nickh"</span>=&gt;[nil],
 <span class="hljs-string">"pjhyett"</span>=&gt;[nil],
 <span class="hljs-string">"schacon"</span>=&gt;[<span class="hljs-string">"lib"</span>, <span class="hljs-string">"tests"</span>],
 <span class="hljs-string">"cdickens"</span>=&gt;[<span class="hljs-string">"doc"</span>],
 <span class="hljs-string">"usinclair"</span>=&gt;[<span class="hljs-string">"doc"</span>],
 <span class="hljs-string">"ebronte"</span>=&gt;[<span class="hljs-string">"doc"</span>]}
</code></pre><p>Agora que você tem as permissões organizadas, é preciso determinar quais os paths que os commits do push modificam, de modo que você pode ter certeza que o usuário que está fazendo o push tem acesso a todos eles.</p>
<p>Você pode muito facilmente ver quais arquivos foram modificados em um único commit com a opção <code>--name-only</code> do comando <code>git log</code> (mencionado brevemente no Capítulo 2):</p>
<pre><code>$ git <span class="hljs-built_in">log</span> -<span class="hljs-number">1</span> --name-only --pretty=<span class="hljs-built_in">format</span>:<span class="hljs-string">''</span> <span class="hljs-number">9</span>f585d

README
lib/test.rb
</code></pre><p>Se você usar a estrutura ACL retornada pelo método <code>get_acl_access_data</code> e verificar a relação dos arquivos listados em cada um dos commits, você pode determinar se o usuário tem acesso ao push de todos os seus commits:</p>
<pre><code><span class="hljs-comment"># only allows certain users to modify certain subdirectories in a project</span>
def check_directory_perms
  access = get_acl_access_data(<span class="hljs-string">'acl'</span>)


  <span class="hljs-comment"># see if anyone is trying to push something they can't</span>
  new_commits = `git rev-list <span class="hljs-comment">#{$oldrev}..#{$newrev}`.split("\n")</span>
  new_commits.<span class="hljs-keyword">each</span> <span class="hljs-built_in">do</span> |rev|
    files_modified = `git <span class="hljs-built_in">log</span> -<span class="hljs-number">1</span> <span class="hljs-comment">--name-only --pretty=format:'' #{rev}`.split("\n")</span>
    files_modified.<span class="hljs-keyword">each</span> <span class="hljs-built_in">do</span> |path|
      next <span class="hljs-keyword">if</span> path.size == <span class="hljs-number">0</span>
      has_file_access = <span class="hljs-constant">false</span>
      access[$user].<span class="hljs-keyword">each</span> <span class="hljs-built_in">do</span> |access_path|
        <span class="hljs-keyword">if</span> !access_path || <span class="hljs-comment"># user has access to everything</span>
          (path.index(access_path) == <span class="hljs-number">0</span>) <span class="hljs-comment"># access to this path</span>
          has_file_access = <span class="hljs-constant">true</span>
        <span class="hljs-function"><span class="hljs-keyword">end</span></span>
      <span class="hljs-function"><span class="hljs-keyword">end</span></span>
      <span class="hljs-keyword">if</span> !has_file_access
        puts <span class="hljs-string">"[POLICY] You do not have access to push to #{path}"</span>
        exit <span class="hljs-number">1</span>
      <span class="hljs-function"><span class="hljs-keyword">end</span></span>
    <span class="hljs-function"><span class="hljs-keyword">end</span></span>
  <span class="hljs-function"><span class="hljs-keyword">end</span></span>
<span class="hljs-function"><span class="hljs-keyword">end</span></span>

check_directory_perms
</code></pre><p>A maior parte do código deve ser fácil de acompanhar. Você receberá uma lista de novos commits do push com <code>git rev-list</code>. Então, para cada um desses, você acha quais arquivos são modificados e verifica se o usuário que está fazendo o push tem acesso a todos os paths sendo modificados. Um Rubyism que pode não ser claro é <code>path.index(access_path) == 0</code>, que é verdadeiro se o caminho começa com <code>access_path</code> — isso garante que <code>access_path</code> não esta apenas em um dos caminhos permitidos, mas um path permitido começa com cada path acessado.</p>
<p>Agora seus usuários não podem fazer o push de qualquer commit com mensagens mal formadas ou com arquivos modificados fora de seus paths designados.</p>
<h3 id="impondo-apenas-fast-forward-pushes">Impondo Apenas Fast-Forward Pushes</h3>
<p>A única coisa que resta é impor apenas fast-forward pushes. Nas versões Git 1.6 ou mais recentes, você pode definir as configurações <code>receive.denyDeletes</code> e <code>receive.denyNonFastForwards</code>. Mas utilizar um hook irá funcionar em versões mais antigas do Git, e você pode modificá-lo para impor a diretiva apenas para determinados usuários ou fazer qualquer outra coisa que você queira.</p>
<p>A lógica para verificar isso é ver se algum commit é acessível a partir da revisão mais antiga que não é acessível a partir da versão mais recente. Se não houver nenhum, então foi um push Fast-Forward; caso contrário, você nega ele:</p>
<pre><code><span class="hljs-comment"># enforces fast-forward only pushes</span>
def check_fast_forward
  missed_refs = `git rev-list <span class="hljs-comment">#{$newrev}..#{$oldrev}`</span>
  missed_ref_count = missed_refs.<span class="hljs-built_in">split</span>(<span class="hljs-string">"\n"</span>).size
  <span class="hljs-keyword">if</span> missed_ref_count &gt; <span class="hljs-number">0</span>
    puts <span class="hljs-string">"[POLICY] Cannot push a non fast-forward reference"</span>
    exit <span class="hljs-number">1</span>
  <span class="hljs-function"><span class="hljs-keyword">end</span></span>
<span class="hljs-function"><span class="hljs-keyword">end</span></span>

check_fast_forward
</code></pre><p>Tudo está configurado. Se você executar <code>chmod u+x .git/hooks/update</code>, que é o arquivo no qual você deve ter colocado todo este código, e então tentar fazer um push de uma referência não fast-forwarded, você verá algo como isto:</p>
<pre><code>$ git push -f origin master
Counting objects: <span class="hljs-number">5</span>, done.
Compressing objects: <span class="hljs-number">100</span>% (<span class="hljs-number">3</span>/<span class="hljs-number">3</span>), done.
Writing objects: <span class="hljs-number">100</span>% (<span class="hljs-number">3</span>/<span class="hljs-number">3</span>), <span class="hljs-number">323</span> bytes, done.
Total <span class="hljs-number">3</span> (delta <span class="hljs-number">1</span>), reused <span class="hljs-number">0</span> (delta <span class="hljs-number">0</span>)
Unpacking objects: <span class="hljs-number">100</span>% (<span class="hljs-number">3</span>/<span class="hljs-number">3</span>), done.
Enforcing Policies...
(refs/heads/master) (<span class="hljs-number">8338</span>c5) (c5b616)
[POLICY] Cannot push a non fast-forward reference
<span class="hljs-keyword">error</span>: hooks/update exited <span class="hljs-keyword">with</span> <span class="hljs-keyword">error</span> code <span class="hljs-number">1</span>
<span class="hljs-keyword">error</span>: hook declined <span class="hljs-keyword">to</span> update refs/heads/master
<span class="hljs-keyword">To</span> git@gitserver:project.git
 ! [remote rejected] master -&gt; master (hook declined)
<span class="hljs-keyword">error</span>: failed <span class="hljs-keyword">to</span> push some refs <span class="hljs-keyword">to</span> <span class="hljs-comment">'git@gitserver:project.git'</span>
</code></pre><p>Há algumas coisas interessantes aqui. Primeiro, você vê quando o hook começa a funcionar.</p>
<pre><code>Enforcing Policies<span class="hljs-attribute">...</span>
(refs/heads/master) (<span class="hljs-number">8338</span>c5) (c5b616)
</code></pre><p>Observe que você imprimiu aquilo no stdout no início do seu script de atualização. É importante notar que qualquer coisa que seu script imprima no stdout será transferido para o cliente.</p>
<p>A próxima coisa que você vai notar é a mensagem de erro.</p>
<pre><code>[POLICY] Cannot push a non fast-forward <span class="hljs-keyword">reference</span>
<span class="hljs-keyword">error</span>: hooks/update exited <span class="hljs-keyword">with</span> <span class="hljs-keyword">error</span> code <span class="hljs-number">1</span>
<span class="hljs-keyword">error</span>: hook declined <span class="hljs-keyword">to</span> update refs/heads/master
</code></pre><p>A primeira linha foi impressa por você, as outras duas foram pelo Git dizendo que o script de atualização não retornou zero e é isso que está impedindo seu push. Por último, você verá isso:</p>
<pre><code><span class="hljs-keyword">To</span> git@gitserver:project.git
 ! [remote rejected] master -&gt; master (hook declined)
<span class="hljs-keyword">error</span>: failed <span class="hljs-keyword">to</span> push some refs <span class="hljs-keyword">to</span> <span class="hljs-comment">'git@gitserver:project.git'</span>
</code></pre><p>Você verá uma mensagem de rejeição remota para cada referência que o seu hook impediu, e ele diz que ele foi recusado especificamente por causa de uma falha de hook.</p>
<p>Além disso, se o marcador ref não existir em nenhum dos seus commits, você verá a mensagem de erro que você está imprimindo para ele.</p>
<pre><code>[POLICY] Your message <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> formatted correctly
</code></pre><p>Ou se alguém tentar editar um arquivo que não têm acesso e fazer um push de um commit que o contém, ele verá algo semelhante. Por exemplo, se um autor de documentação tenta fazer um push de um commit modificando algo no diretório <code>lib</code>, ele verá</p>
<pre><code>[POLICY] You <span class="hljs-keyword">do</span> <span class="hljs-keyword">not</span> have access <span class="hljs-keyword">to</span> push <span class="hljs-keyword">to</span> <span class="hljs-keyword">lib</span>/test.rb
</code></pre><p>Isto é tudo. A partir de agora, desde que o script <code>update</code> esteja lá e seja executável, seu repositório nunca será rebobinado e nunca terá uma mensagem de commit sem o seu padrão nela, e os usuários terão restrições.</p>
<h2 id="hooks-do-lado-cliente">Hooks do Lado Cliente</h2>
<p>A desvantagem desta abordagem é a choraminga que resultará inevitavelmente quando os pushes de commits de seus usuários forem rejeitados. Tendo seu trabalho cuidadosamente elaborada rejeitado no último minuto pode ser extremamente frustrante e confuso; e, além disso, eles vão ter que editar seu histórico para corrigi-lo, o que nem sempre é para os fracos de coração.</p>
<p>A resposta para este dilema é fornecer alguns hooks do lado cliente que os usuários possam usar para notificá-los quando eles estão fazendo algo que o servidor provavelmente rejeitará. Dessa forma, eles podem corrigir quaisquer problemas antes de fazer o commit e antes desses problemas se tornarem mais difíceis de corrigir. Já que hooks não são transferidos com um clone de um projeto, você deve distribuir esses scripts de alguma outra forma e, então, usuários devem copiá-los para seu diretório <code>.git/hooks</code> e torná-los executáveis. Você pode distribuir esses hooks dentro do projeto ou em um projeto separado, mas não há maneiras de configurá-los automaticamente.</p>
<p>Para começar, você deve verificar a sua mensagem de confirmação antes que cada commit seja gravado, então você saberá que o servidor não irá rejeitar as alterações devido a mensagens de commit mal formatadas. Para fazer isso, você pode adicionar o hook <code>commit-msg</code>. Se fizer ele ler as mensagens do arquivo passado como o primeiro argumento e comparar ele com o padrão, você pode forçar o Git a abortar o commit se eles não corresponderem:</p>
<pre><code><span class="hljs-shebang">#!/usr/bin/env ruby</span>
message_file = ARGV[<span class="hljs-number">0</span>]
message = File.read(message_file)

$regex = /\[<span class="hljs-keyword">ref</span>: (\d+)\]/

<span class="hljs-keyword">if</span> !$regex.match(message)
  puts <span class="hljs-string">"[POLICY] Your message is not formatted correctly"</span>
  exit <span class="hljs-number">1</span>
end
</code></pre><p>Se esse script está no lugar correto (em <code>.git/hooks/commit-msg</code>) e é executável, e você fizer um commit com uma mensagem que não está formatada corretamente, você verá isso:</p>
<pre><code>$ git <span class="hljs-operator"><span class="hljs-keyword">commit</span> -am <span class="hljs-string">'test'</span>
[POLICY] Your message <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> formatted correctly</span>
</code></pre><p>Nenhum commit foi concluído nessa instância. No entanto, se a mensagem conter o padrão adequado, o Git permite o commit:</p>
<pre><code>$ git commit -am <span class="hljs-string">'test [ref: 132]'</span>
[master e05c914] test [<span class="hljs-keyword">ref</span>: <span class="hljs-number">132</span>]
 <span class="hljs-number">1</span> files changed, <span class="hljs-number">1</span> insertions(+), <span class="hljs-number">0</span> deletions(-)
</code></pre><p>Em seguida, você quer ter certeza de que você não está modificando os arquivos que estão fora do seu escopo ACL. Se o seu diretório de projeto <code>.git</code> contém uma cópia do arquivo ACL que você usou anteriormente, então o seguinte script <code>pre-commit</code> irá impor essas restrições para você:</p>
<pre><code>#!/usr/bin/env ruby

$user = ENV['USER']

# [ <span class="hljs-operator"><span class="hljs-keyword">insert</span> acl_access_data method <span class="hljs-keyword">from</span> above ]

# <span class="hljs-keyword">only</span> allows certain users <span class="hljs-keyword">to</span> modify certain subdirectories <span class="hljs-keyword">in</span> a project
def check_directory_perms
  access = get_acl_access_data(<span class="hljs-string">'.git/acl'</span>)

  files_modified = <span class="hljs-string">`git diff-index --cached --name-only HEAD`</span>.split(<span class="hljs-string">"\n"</span>)
  files_modified.<span class="hljs-keyword">each</span> <span class="hljs-keyword">do</span> |path|
    <span class="hljs-keyword">next</span> <span class="hljs-keyword">if</span> path.<span class="hljs-keyword">size</span> == <span class="hljs-number">0</span>
    has_file_access = <span class="hljs-keyword">false</span>
    access[$<span class="hljs-keyword">user</span>].<span class="hljs-keyword">each</span> <span class="hljs-keyword">do</span> |access_path|
    <span class="hljs-keyword">if</span> !access_path || (path.index(access_path) == <span class="hljs-number">0</span>)
      has_file_access = <span class="hljs-keyword">true</span>
    <span class="hljs-keyword">end</span>
    <span class="hljs-keyword">if</span> !has_file_access
      puts <span class="hljs-string">"[POLICY] You do not have access to push to #{path}"</span>
      exit <span class="hljs-number">1</span>
    <span class="hljs-keyword">end</span>
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span>

check_directory_perms</span>
</code></pre><p>Este é aproximadamente o mesmo script da parte do lado servidor, mas com duas diferenças importantes. Primeiro, o arquivo ACL está em um lugar diferente, porque este script é executado a partir do seu diretório de trabalho, e não de seu diretório Git. Você tem que mudar o path para o arquivo ACL, disso</p>
<pre><code><span class="hljs-keyword">access</span> = get_acl_access_data(<span class="hljs-attribute">'acl</span>')
</code></pre><p>para isso:</p>
<pre><code>access = get_acl_access_data(<span class="hljs-string">'.git/acl'</span>)
</code></pre><p>A outra diferença importante é a forma como você obtem uma lista dos arquivos que foram alterados. Como o método do lado servidor olha no log de ​​commits e, neste momento, o commit não foi gravado ainda, você deve pegar sua lista de arquivos da área staging. Em vez de</p>
<pre><code>files_modified = `git <span class="hljs-built_in">log</span> -<span class="hljs-number">1</span> --name-only --pretty=<span class="hljs-built_in">format</span>:<span class="hljs-string">''</span> <span class="hljs-preprocessor">#{ref}`</span>
</code></pre><p>você deve usar</p>
<pre><code><span class="hljs-comment">files_modified</span> <span class="hljs-comment">=</span> <span class="hljs-comment">`git</span> <span class="hljs-comment">diff</span><span class="hljs-literal">-</span><span class="hljs-comment">index</span> <span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-comment">cached</span> <span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-comment">name</span><span class="hljs-literal">-</span><span class="hljs-comment">only</span> <span class="hljs-comment">HEAD`</span>
</code></pre><p>Mas essas são as duas únicas diferenças — caso contrário, o script funciona da mesma maneira. Uma ressalva é que ele espera que você esteja executando localmente como o mesmo usuário que você fez o push para a máquina remota. Se ele for diferente, você deve definir a variável <code>$user</code> manualmente.</p>
<p>A última coisa que você tem que fazer é verificar se você não está tentando fazer o push de referências não fast-forwarded, mas isso é um pouco menos comum. Para obter uma referência que não é um fast-forward, você tem que fazer um rebase depois de um commit que já foi enviado por um push ou tentar fazer o push de um branch local diferente até o mesmo branch remoto.</p>
<p>Como o servidor vai dizer que você não pode fazer um push não fast-forward de qualquer maneira, e o hook impede pushes forçados, a única coisa acidental que você pode tentar deter são commits de rebase que já foram enviados por um push.</p>
<p>Aqui está um exemplo de script pré-rebase que verifica isso. Ele recebe uma lista de todos os commits que você está prestes a reescrever e verifica se eles existem em qualquer uma das suas referências remotas. Se ele vê um que é acessível a partir de uma de suas referências remotas, ele aborta o rebase:</p>
<pre><code><span class="hljs-comment">#!/usr/bin/env ruby</span>

base_branch = ARGV[<span class="hljs-number">0</span>]
<span class="hljs-keyword">if</span> ARGV[<span class="hljs-number">1</span>]
  topic_branch = ARGV[<span class="hljs-number">1</span>]
<span class="hljs-keyword">else</span>
  topic_branch = <span class="hljs-string">"HEAD"</span>
<span class="hljs-function"><span class="hljs-keyword">end</span></span>

target_shas = `git rev-list <span class="hljs-comment">#{base_branch}..#{topic_branch}`.split("\n")</span>
remote_refs = `git branch -r`.<span class="hljs-built_in">split</span>(<span class="hljs-string">"\n"</span>).map { |r| r.strip }

target_shas.<span class="hljs-keyword">each</span> <span class="hljs-built_in">do</span> |sha|
  remote_refs.<span class="hljs-keyword">each</span> <span class="hljs-built_in">do</span> |remote_ref|
    shas_pushed = `git rev-list ^<span class="hljs-comment">#{sha}^@ refs/remotes/#{remote_ref}`</span>
    <span class="hljs-keyword">if</span> shas_pushed.<span class="hljs-built_in">split</span>(“\n”).<span class="hljs-built_in">include</span>?(sha)
      puts <span class="hljs-string">"[POLICY] Commit #{sha} has already been pushed to #{remote_ref}"</span>
      exit <span class="hljs-number">1</span>
    <span class="hljs-function"><span class="hljs-keyword">end</span></span>
  <span class="hljs-function"><span class="hljs-keyword">end</span></span>
<span class="hljs-function"><span class="hljs-keyword">end</span></span>
</code></pre><p>Este script utiliza uma sintaxe que não foi coberta na seção Seleção de Revisão do Capítulo 6. Você obterá uma lista de commits que já foram foram enviados em um push executando isto:</p>
<pre><code>git rev-list ^#{<span class="ruby">sha}</span>^@ refs/remotes/#{<span class="ruby">remote_ref}</span>
</code></pre><p>A sintaxe <code>SHA^@</code> resolve para todos os pais daquele commit. Você está à procura de qualquer commit que é acessível a partir do último commit no remoto e que não é acessível a partir de qualquer pai de qualquer um dos SHAs que você está tentando fazer o push — o que significa que é um fast-forward.</p>
<p>A principal desvantagem desta abordagem é que ela pode ser muito lenta e muitas vezes é desnecessária — se você não tentar forçar o push com <code>-f</code>, o servidor irá avisá-lo e não aceitará o push. No entanto, é um exercício interessante e pode, em teoria, ajudar a evitar um rebase que você possa mais tarde ter que voltar atrás e corrigir.</p>

                    
                    </section>
                
                </div>
            </div>
        </div>

        
        <a href="../customizando_o_git/hooks_do_git.html" class="navigation navigation-prev"><i class="fa fa-angle-left"></i></a>
        
        
        <a href="../customizando_o_git/sumario.html" class="navigation navigation-next"><i class="fa fa-angle-right"></i></a>
        
    </div>
</div>

        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.1.3/ace.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.1.3/mode-javascript.js"></script>
        <script src="../gitbook/jsrepl/jsrepl.js" id="jsrepl-script"></script>
        <script src="../gitbook/app.js"></script>
        
    </body>
</html>
